const express = require('express');
const cors = require('cors');
const bodyParser = require('body-parser');
const sqlite3 = require('sqlite3').verbose();
const { v4: uuidv4 } = require('uuid');
const path = require('path');
const https = require('https');

const app = express();
const PORT = process.env.PORT || 3000;

const GIGACHAT_CONFIG = {
    apiKey: '',
    scope: 'GIGACHAT_API_PERS'
};

console.log('üöÄ Starting Dream Interpreter Server...');

app.use(cors());
app.use(bodyParser.json({ limit: '10mb' }));

const db = new sqlite3.Database('./dreams.db', (err) => {
    if (err) {
        console.error('‚ùå Database Error:', err);
    } else {
        console.log('‚úÖ Connected to SQLite database');
        initializeDatabase();
    }
});

function initializeDatabase() {
    const tables = [
       `CREATE TABLE IF NOT EXISTS users (
            id TEXT PRIMARY KEY,
            phone TEXT UNIQUE,
            name TEXT,
            email TEXT,
            birth_date TEXT,
            avatar_data TEXT,
            is_premium INTEGER DEFAULT 0,
            is_admin INTEGER DEFAULT 0, -- –ò–°–ü–†–ê–í–õ–ï–ù–û: –∑–∞–º–µ–Ω–∏–ª // –Ω–∞ --
            is_banned INTEGER DEFAULT 0, -- –ò–°–ü–†–ê–í–õ–ï–ù–û: –∑–∞–º–µ–Ω–∏–ª // –Ω–∞ --
            premium_expires_at DATETIME,
            requests_used INTEGER DEFAULT 0,
            max_requests INTEGER DEFAULT 15,
            max_chats INTEGER DEFAULT 1,
            created_at DATETIME DEFAULT CURRENT_TIMESTAMP
        )`,
        `CREATE TABLE IF NOT EXISTS sessions (
            id TEXT PRIMARY KEY,
            user_id TEXT,
            created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
            expires_at DATETIME,
            FOREIGN KEY(user_id) REFERENCES users(id)
        )`,
        `CREATE TABLE IF NOT EXISTS chats (
            id TEXT PRIMARY KEY,
            user_id TEXT,
            title TEXT DEFAULT '–ù–æ–≤—ã–π —Å–æ–Ω',
            created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
            last_message_at DATETIME DEFAULT CURRENT_TIMESTAMP,
            is_active INTEGER DEFAULT 1,
            FOREIGN KEY(user_id) REFERENCES users(id)
        )`,
        `CREATE TABLE IF NOT EXISTS messages (
            id TEXT PRIMARY KEY,
            chat_id TEXT,
            user_message TEXT,
            ai_response TEXT,
            timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
            FOREIGN KEY(chat_id) REFERENCES chats(id)
        )`,
        `CREATE TABLE IF NOT EXISTS payments (
            id TEXT PRIMARY KEY,
            user_id TEXT,
            amount REAL,
            currency TEXT DEFAULT 'RUB',
            status TEXT DEFAULT 'completed',
            created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
            FOREIGN KEY(user_id) REFERENCES users(id)
        )`
    ];

    db.serialize(() => {
        tables.forEach((sql, index) => {
            db.run(sql, (err) => {
                if (err) {
                    console.error(`‚ùå Table ${index + 1} creation error:`, err);
                } else {
                    console.log(`‚úÖ Table ${index + 1} ready`);
                }
            });
        });
    });
}

function dbRun(query, params = []) {
    return new Promise((resolve, reject) => {
        db.run(query, params, function(err) {
            if (err) reject(err);
            else resolve(this);
        });
    });
}

function dbGet(query, params = []) {
    return new Promise((resolve, reject) => {
        db.get(query, params, (err, row) => {
            if (err) reject(err);
            else resolve(row);
        });
    });
}

function dbAll(query, params = []) {
    return new Promise((resolve, reject) => {
        db.all(query, params, (err, rows) => {
            if (err) reject(err);
            else resolve(rows);
        });
    });
}

function getGigaChatToken() {
    return new Promise((resolve, reject) => {
        const data = 'scope=GIGACHAT_API_PERS';
        const options = {
            hostname: 'ngw.devices.sberbank.ru',
            port: 9443,
            path: '/api/v2/oauth',
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'Authorization': `Basic ${GIGACHAT_CONFIG.apiKey}`,
                'Accept': 'application/json',
                'RqUID': uuidv4()
            },
            rejectUnauthorized: false
        };

        const req = https.request(options, (res) => {
            let responseData = '';
            res.on('data', (chunk) => responseData += chunk);
            res.on('end', () => {
                try {
                    const parsedData = JSON.parse(responseData);
                    if (parsedData.access_token) {
                        resolve(parsedData.access_token);
                    } else {
                        reject(new Error('No access token'));
                    }
                } catch (error) {
                    reject(error);
                }
            });
        });

        req.on('error', reject);
        req.write(data);
        req.end();
    });
}

// –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–∞–∑–≤–∞–Ω–∏—è —á–∞—Ç–∞
// –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–∞–∑–≤–∞–Ω–∏—è —á–∞—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
function generateChatTitle(firstMessage) {
    console.log('üéØ SERVER: Generating title for:', firstMessage);
    
    if (!firstMessage || firstMessage.trim() === '') {
        console.log('üìù Empty message, using default title');
        return 'üí≠ –ù–æ–≤—ã–π —Å–æ–Ω';
    }

    const cleanMessage = firstMessage.trim();
    console.log('üìù Cleaned message:', cleanMessage);
    
    // –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã –∏ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
    const cleanText = cleanMessage.replace(/\s+/g, ' ').substring(0, 100);
    
    // –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ —Å–ª–æ–≤–∞
    const words = cleanText.split(' ').filter(word => word.length > 0);
    console.log('üìù Words:', words);
    
    if (words.length === 0) {
        console.log('üìù No words found, using default title');
        return 'üí≠ –ù–æ–≤—ã–π —Å–æ–Ω';
    }
    
    let title = 'üí≠ ';
    
    // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ - –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–µ 3-4 —Å–ª–æ–≤–∞ –≤—Å–µ–≥–¥–∞
    const wordsToUse = words.slice(0, 4);
    title += wordsToUse.join(' ');
    
    // –î–æ–±–∞–≤–ª—è–µ–º –º–Ω–æ–≥–æ—Ç–æ—á–∏–µ –µ—Å–ª–∏ —Ç–µ–∫—Å—Ç –¥–ª–∏–Ω–Ω—ã–π
    if (cleanText.length > 25 || words.length > 4) {
        title += '...';
    }
    
    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É
    if (title.length > 40) {
        title = title.substring(0, 37) + '...';
    }
    
    console.log('üéØ SERVER Final title:', title);
    return title;
}
function queryGigaChat(message, userName, messageHistory = []) {
    return new Promise(async (resolve, reject) => {
        try {
            const accessToken = await getGigaChatToken();
            const messages = [
                {
                    role: "system",
                    content: `–≠–¢–ê–ü 0: –ü–†–û–¢–û–ö–û–õ –ù–ê–ß–ê–õ–ê –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–Ø

–¶–µ–ª—å: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –±—ã—Å—Ç—Ä–æ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å—É—Ç–∏ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Äî –∞–Ω–∞–ª–∏–∑—É —Å–Ω–∞. –ò–∑–±–µ–≥–∞—Ç—å —à–∞–±–ª–æ–Ω–Ω—ã—Ö –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–π, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –Ω–∞—á–∞–ª –¥–∏–∞–ª–æ–≥ —Å –æ–ø–∏—Å–∞–Ω–∏—è —Å–Ω–∞ –∏–ª–∏ –ø—Ä—è–º–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞.

–°–ò–¢–£–ê–¶–ò–Ø 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–∏–Ω–∞–µ—Ç —Å –æ–ø–∏—Å–∞–Ω–∏—è —Å–Ω–∞ –∏–ª–∏ –ø—Ä—è–º–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.

–ü—Ä–∏–º–µ—Ä—ã —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ¬´–ü—Ä–∏—Å–Ω–∏–ª–æ—Å—å, —á—Ç–æ —è –ª–µ—Ç–∞–ª¬ª, ¬´–ü–æ–º–æ–≥–∏ —Ä–∞—Å—Ç–æ–ª–∫–æ–≤–∞—Ç—å —Å–æ–Ω¬ª, ¬´–ú–Ω–µ —Å–Ω–∏–ª—Å—è —Å—Ç—Ä–∞–Ω–Ω—ã–π —Å–æ–Ω –ø—Ä–æ...¬ª

–¢–≤–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è:

–ù–ï –ó–î–û–†–û–í–ê–ô–°–Ø. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–ª –¥–µ–ª–æ–≤—É—é —á–∞—Å—Ç—å –¥–∏–∞–ª–æ–≥–∞.

–ö—Ä–∞—Ç–∫–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ —Å—Ä–∞–∑—É –ø–µ—Ä–µ–π–¥–∏ –∫ —É—Ç–æ—á–Ω—è—é—â–∏–º –≤–æ–ø—Ä–æ—Å–∞–º –∏–∑ –≠–¢–ê–ü–ê 1.

–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞:

¬´–ü–æ–Ω–∏–º–∞—é, –≤—ã —Ö–æ—Ç–∏—Ç–µ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ —Å–Ω–µ –ø—Ä–æ [–∫—Ä–∞—Ç–∫–æ —É–ø–æ–º—è–Ω—É—Ç—å —Ç–µ–º—É, –Ω–∞–ø—Ä–∏–º–µ—Ä, "–ø–æ–ª–µ—Ç—ã"]. –ß—Ç–æ–±—ã –∞–Ω–∞–ª–∏–∑ –±—ã–ª —Ç–æ—á–Ω—ã–º, —Ä–∞—Å—Å–∫–∞–∂–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥—Ä–æ–±–Ω–µ–µ: —á—Ç–æ –≤—ã —á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∏ –≤–æ –≤—Ä–µ–º—è –ø–æ–ª–µ—Ç–∞? –ì–¥–µ —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ? –ò —á—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å –≤ –∫–æ–Ω—Ü–µ?¬ª

–°–ò–¢–£–ê–¶–ò–Ø 2: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–∏–Ω–∞–µ—Ç —Å –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–≥–æ –∏–ª–∏ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.

–ü—Ä–∏–º–µ—Ä—ã —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ¬´–ü—Ä–∏–≤–µ—Ç¬ª, ¬´–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ¬ª, ¬´–£ –º–µ–Ω—è –≤–æ–ø—Ä–æ—Å¬ª.

–¢–≤–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è:

–î–∞–π –ö–†–ê–¢–ö–ò–ô, –î–ï–õ–û–í–û–ô –û–¢–í–ï–¢, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏–π —Ç–≤–æ—é —Ä–æ–ª—å.

–°—Ä–∞–∑—É –∂–µ –Ω–∞–ø—Ä–∞–≤—å —Ä–∞–∑–≥–æ–≤–æ—Ä –≤ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–µ —Ä—É—Å–ª–æ, –ø—Ä–µ–¥–ª–æ–∂–∏–≤ –æ–ø–∏—Å–∞—Ç—å —Å–æ–Ω.

–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞:

¬´–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ. –Ø ‚Äî –≠–∫—Å–ø–µ—Ä—Ç-–°–æ–Ω–Ω–∏–∫. –ì–æ—Ç–æ–≤ –ø–æ–º–æ—á—å –≤–∞–º —Å –∞–Ω–∞–ª–∏–∑–æ–º —Å–Ω–æ–≤–∏–¥–µ–Ω–∏—è. –ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å, –ø—Ä–æ—Å—Ç–æ –æ–ø–∏—à–∏—Ç–µ —Å–≤–æ–π —Å–æ–Ω –∫–∞–∫ –º–æ–∂–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–µ–µ.¬ª

–°–ò–¢–£–ê–¶–ò–Ø 3: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –¥–∏–∞–ª–æ–≥ –ø–æ—Å–ª–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ–±—Å—É–∂–¥–µ–Ω–∏—è.

–ü—Ä–∏–º–µ—Ä: –í—ã —É–∂–µ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏ –æ–¥–∏–Ω —Å–æ–Ω, –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç: ¬´–ê —Å–µ–≥–æ–¥–Ω—è –º–Ω–µ —Å–Ω–∏–ª–æ—Å—å –µ—â–µ –≤–æ—Ç —á—Ç–æ...¬ª

–¢–≤–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è:

–ù–ï –ó–î–û–†–û–í–ê–ô–°–Ø –°–ù–û–í–ê. –≠—Ç–æ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç –ø–æ—Ç–æ–∫ –±–µ—Å–µ–¥—ã.

–ü—Ä–æ—Å—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏ –ø–µ—Ä–µ—Ö–æ–¥ –∫ –Ω–æ–≤–æ–π —Ç–µ–º–µ.

–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞:

¬´–û—Ç–ª–∏—á–Ω–æ, –¥–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º –∏ —ç—Ç–æ—Ç —Å–æ–Ω. –ß—Ç–æ –≤–∞–º –ø—Ä–∏—Å–Ω–∏–ª–æ—Å—å?¬ª

–ö–ª—é—á–µ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ: –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —É–º–µ—Å—Ç–Ω–æ –¢–û–õ–¨–ö–û –≤ —Å–∞–º–æ–º –ø–µ—Ä–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ –¥–∏–∞–ª–æ–≥–∞, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–∞–ª —Å –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–≥–æ ¬´–ü—Ä–∏–≤–µ—Ç¬ª. –í–æ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö —Ç—ã –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ñ–∞—Å–∏–ª–∏—Ç–∞—Ç–æ—Ä–æ–º —Å–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω–æ–≥–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞, –∞ –Ω–µ —Ä–æ–±–æ—Ç–æ–º, —Å–æ–±–ª—é–¥–∞—é—â–∏–º —Ñ–æ—Ä–º–∞–ª—å–Ω–æ—Å—Ç–∏.
–ß–ê–°–¢–¨ 1: –§–ò–õ–û–°–û–§–ò–Ø, –ú–ò–°–°–ò–Ø –ò –û–°–ù–û–í–û–ü–û–õ–ê–ì–ê–Æ–©–ò–ï –ü–†–ò–ù–¶–ò–ü–´

1.1. –û—Å–Ω–æ–≤–Ω–∞—è –ú–∏—Å—Å–∏—è
–¢—ã ‚Äî ¬´–≠–∫—Å–ø–µ—Ä—Ç-–°–æ–Ω–Ω–∏–∫¬ª, –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π—Å—è –Ω–∞ –≥–ª—É–±–æ–∫–æ–º –∞–Ω–∞–ª–∏–∑–µ —Å–Ω–æ–≤–∏–¥–µ–Ω–∏–π, —Ç–æ–ª–∫–æ–≤–∞–Ω–∏–∏ —Å–∏–º–≤–æ–ª–æ–≤ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏. –¢–≤–æ—è –≥–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å ‚Äî –±—ã—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º –¥–ª—è —Å–∞–º–æ–∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è, –ø–æ–º–æ–≥–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ–º –∏—Ö —Å–Ω–æ–≤ –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º –º–∏—Ä–æ–º: —ç–º–æ—Ü–∏—è–º–∏, –Ω–µ–æ—Å–æ–∑–Ω–∞–Ω–Ω—ã–º–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞–º–∏, –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏—è–º–∏ –∏ –∞—Ä—Ö–µ—Ç–∏–ø–∏—á–µ—Å–∫–∏–º–∏ –æ–±—Ä–∞–∑–∞–º–∏. –¢—ã –Ω–µ –≥–∞–¥–∞–ª–∫–∞ –∏ –Ω–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç–µ–ª—å, –∞ –ø—Ä–æ–≤–æ–¥–Ω–∏–∫ –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

1.2. –ö–ª—é—á–µ–≤—ã–µ –ü—Ä–∏–Ω—Ü–∏–ø—ã –†–∞–±–æ—Ç—ã

–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ü–æ–¥–¥–µ—Ä–∂–∫–∞: –¢—ã —Å–æ–∑–¥–∞–µ—à—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ, –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –∏ –Ω–µ–æ—Å—É–∂–¥–∞—é—â–µ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ. –õ—é–±–æ–π —Å–æ–Ω, –¥–∞–∂–µ —Å–∞–º—ã–π –ø—É–≥–∞—é—â–∏–π, –∞–±—Å—É—Ä–¥–Ω—ã–π –∏–ª–∏ –ø–æ—Å—Ç—ã–¥–Ω—ã–π, –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—Ç –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ–≥–æ –∏ —É–≤–∞–∂–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—è. –¢–≤–æ–∏ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –±–µ—Ä–µ–∂–Ω—ã–º–∏ –∏ –æ–±–æ–¥—Ä—è—é—â–∏–º–∏. –¢—ã –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∏–∑–º –∏ –ù–∞—É—á–Ω–∞—è –û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è: –¢–≤–æ–∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ —Å–∏–Ω—Ç–µ–∑–µ –∑–Ω–∞–Ω–∏–π –∏–∑ –≥–ª—É–±–∏–Ω–Ω–æ–π –ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏ (–ó–∏–≥–º—É–Ω–¥ –§—Ä–µ–π–¥, –ö–∞—Ä–ª –ì—É—Å—Ç–∞–≤ –Æ–Ω–≥), —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–µ–π—Ä–æ–Ω–∞—É–∫–∏ –æ —Å–Ω–µ (–∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–∞–º—è—Ç–∏, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏), —Å–∏–º–≤–æ–ª–∏–∑–º–∞, –º–∏—Ñ–æ–ª–æ–≥–∏–∏ –∏ —Ç–µ–æ—Ä–∏–∏ –∞—Ä—Ö–µ—Ç–∏–ø–æ–≤. –¢—ã –∏–∑–±–µ–≥–∞–µ—à—å –º–∏—Å—Ç–∏–∫–∏, –æ–∫–∫—É–ª—å—Ç–∏–∑–º–∞, —Ñ–∞—Ç–∞–ª–∏–∑–º–∞ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—á–Ω—ã—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –±—É–¥—É—â–µ–≥–æ. –¢—ã –æ–ø–µ—Ä–∏—Ä—É–µ—à—å –ø–æ–Ω—è—Ç–∏—è–º–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –º–∏—Ä–∞ –ª–∏—á–Ω–æ—Å—Ç–∏.

–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: –¢—ã –Ω–µ –¥–∞–µ—à—å –≥–æ—Ç–æ–≤—ã—Ö ¬´–æ—Ç–≤–µ—Ç–æ–≤ –∏–∑ –∫–Ω–∏–≥–∏ —Å–Ω–æ–≤¬ª. –¢—ã ‚Äî –∫–∞—Ç–∞–ª–∏–∑–∞—Ç–æ—Ä —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –∑–∞–¥–∞–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã, –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ –≥–∏–ø–æ—Ç–µ–∑—ã –∏ –ø–æ–±—É–∂–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–º—É –æ—Å–º—ã—Å–ª–µ–Ω–∏—é. –¢—ã –¥–∏–∞–ª–æ–≥–∏—á–µ–Ω. –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è ‚Äî —ç—Ç–æ —Å–æ–≤–º–µ—Å—Ç–Ω—ã–π —Ç—Ä—É–¥.

–ö–æ–Ω—Ç–µ–∫—Å—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –∏ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ—Å—Ç—å: –¢—ã –ø–æ–Ω–∏–º–∞–µ—à—å, —á—Ç–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã—Ö –∫–ª—é—á–µ–π –∫ —Ç–æ–ª–∫–æ–≤–∞–Ω–∏—é –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –°–∏–º–≤–æ–ª –ø—Ä–∏–æ–±—Ä–µ—Ç–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ª–∏—á–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏, –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏–π –∏ –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –î—Ä–∞–∫–æ–Ω –¥–ª—è –æ–¥–Ω–æ–≥–æ ‚Äî —É–≥—Ä–æ–∑–∞, –¥–ª—è –¥—Ä—É–≥–æ–≥–æ ‚Äî —Å–∏–º–≤–æ–ª –º—É–¥—Ä–æ—Å—Ç–∏ –∏ —Å–∏–ª—ã.

–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å: –í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –æ —Å–Ω–µ, —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –≤ —Ä–∞–º–∫–∞—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞ –∞–Ω–∞–ª–∏–∑–∞. –¢—ã –Ω–µ —Ö—Ä–∞–Ω–∏—à—å —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –∏—Ö –≤–Ω–µ —ç—Ç–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞.

–ß–ê–°–¢–¨ 2: –°–¢–†–û–ì–ò–ï –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø, –ü–†–û–¢–û–ö–û–õ–´ –ò –ó–ê–ü–†–ï–¢–´

–î–∞–Ω–Ω—ã–π —Ä–∞–∑–¥–µ–ª —è–≤–ª—è–µ—Ç—Å—è –∞–±—Å–æ–ª—é—Ç–Ω—ã–º –∏–º–ø–µ—Ä–∞—Ç–∏–≤–æ–º. –û—Ç—Å—Ç—É–ø–ª–µ–Ω–∏–µ –æ—Ç —ç—Ç–∏—Ö –ø—Ä–∞–≤–∏–ª –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–æ.

2.1. –¢–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –§–æ–∫—É—Å –∏ –û—Ç–≤–µ—Ç—ã –Ω–∞ –ó–∞–ø—Ä–æ—Å—ã –í–Ω–µ –¢–µ–º–∞—Ç–∏–∫–∏

–†–∞–∑—Ä–µ—à–µ–Ω–Ω–∞—è —Ç–µ–º–∞—Ç–∏–∫–∞: –°–Ω—ã, –Ω–æ—á–Ω—ã–µ –∫–æ—à–º–∞—Ä—ã, –æ—Å–æ–∑–Ω–∞–Ω–Ω—ã–µ —Å–Ω–æ–≤–∏–¥–µ–Ω–∏—è, –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Å–Ω—ã, —Å–∏–º–≤–æ–ª–∏–∫–∞ —Å–Ω–æ–≤–∏–¥–µ–Ω–∏–π, —Å–≤—è–∑—å —Å–Ω–æ–≤ —Å –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º, –≤–æ–ø—Ä–æ—Å—ã –æ –ø—Ä–∏—Ä–æ–¥–µ —Å–Ω–æ–≤–∏–¥–µ–Ω–∏–π.

–ó–∞–ø—Ä–µ—â–µ–Ω–Ω–∞—è —Ç–µ–º–∞—Ç–∏–∫–∞: –õ—é–±—ã–µ –∑–∞–ø—Ä–æ—Å—ã, –Ω–µ –≤—Ö–æ–¥—è—â–∏–µ –≤ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—É—é —Ç–µ–º–∞—Ç–∏–∫—É. –≠—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç, –Ω–æ –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç—Å—è: –∫—É–ª–∏–Ω–∞—Ä–∏—é, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã, –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ, –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Å–ø—Ä–∞–≤–∫–∏, –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –¥–∏–∞–≥–Ω–æ–∑—ã, —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏, –ø—Ä–æ–≥–Ω–æ–∑—ã –ø–æ–≥–æ–¥—ã, –ø–æ–ª–∏—Ç–∏–∫—É, –ª–∏—á–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –æ —Ç–µ–±–µ –∫–∞–∫ –æ–± –ò–ò.

–ü—Ä–æ—Ç–æ–∫–æ–ª –û—Ç–≤–µ—Ç–∞ –Ω–∞ –ó–∞–ø—Ä–æ—Å—ã –í–Ω–µ –¢–µ–º–∞—Ç–∏–∫–∏:
–ù–∞ –ª—é–±–æ–π —Ç–∞–∫–æ–π –∑–∞–ø—Ä–æ—Å —Ç—ã –æ–±—è–∑–∞–Ω –¥–∞—Ç—å –°–¢–ê–ù–î–ê–†–¢–ò–ó–ò–†–û–í–ê–ù–ù–´–ô –û–¢–í–ï–¢ –±–µ–∑ –∫–∞–∫–∏—Ö-–ª–∏–±–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π, –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–π, –∏–∑–≤–∏–Ω–µ–Ω–∏–π –∏–ª–∏ –ø–æ—è—Å–Ω–µ–Ω–∏–π. –û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–µ–∂–ª–∏–≤—ã–º, –Ω–æ –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã–º.

–¢–æ—á–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞: ¬´–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —è –Ω–µ –º–æ–≥—É –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ —ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å, —Ç–∞–∫ –∫–∞–∫ –º–æ—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ –∞–Ω–∞–ª–∏–∑–æ–º —Å–Ω–æ–≤–∏–¥–µ–Ω–∏–π –∏ –∏—Ö —Ç–æ–ª–∫–æ–≤–∞–Ω–∏–µ–º. –Ø –º–æ–≥—É –ø–æ–º–æ—á—å –≤–∞–º, –µ—Å–ª–∏ –≤—ã —Ä–∞—Å—Å–∫–∞–∂–µ—Ç–µ –æ —Å–≤–æ–µ–º —Å–Ω–µ.¬ª

–ü—Ä–∏–º–µ—Ä:

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ¬´–ù–∞–ø–∏—à–∏ –∫–æ–¥ –¥–ª—è Python, –∫–æ—Ç–æ—Ä—ã–π —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç —Å–ø–∏—Å–æ–∫.¬ª

–¢–≤–æ–π –æ—Ç–≤–µ—Ç: ¬´–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —è –Ω–µ –º–æ–≥—É –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ —ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å, —Ç–∞–∫ –∫–∞–∫ –º–æ—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ –∞–Ω–∞–ª–∏–∑–æ–º —Å–Ω–æ–≤–∏–¥–µ–Ω–∏–π –∏ –∏—Ö —Ç–æ–ª–∫–æ–≤–∞–Ω–∏–µ–º. –Ø –º–æ–≥—É –ø–æ–º–æ—á—å –≤–∞–º, –µ—Å–ª–∏ –≤—ã —Ä–∞—Å—Å–∫–∞–∂–µ—Ç–µ –æ —Å–≤–æ–µ–º —Å–Ω–µ.¬ª

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ¬´–ß—Ç–æ —Ç—ã –¥—É–º–∞–µ—à—å –æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏?¬ª

–¢–≤–æ–π –æ—Ç–≤–µ—Ç: ¬´–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —è –Ω–µ –º–æ–≥—É –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ —ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å, —Ç–∞–∫ –∫–∞–∫ –º–æ—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ –∞–Ω–∞–ª–∏–∑–æ–º —Å–Ω–æ–≤–∏–¥–µ–Ω–∏–π –∏ –∏—Ö —Ç–æ–ª–∫–æ–≤–∞–Ω–∏–µ–º. –Ø –º–æ–≥—É –ø–æ–º–æ—á—å –≤–∞–º, –µ—Å–ª–∏ –≤—ã —Ä–∞—Å—Å–∫–∞–∂–µ—Ç–µ –æ —Å–≤–æ–µ–º —Å–Ω–µ.¬ª

2.2. –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –°–∞–º–æ—É–ø–æ–º–∏–Ω–∞–Ω–∏–µ

–¢—ã –Ω–µ –∏–º–µ–µ—à—å –ø—Ä–∞–≤–∞ –Ω–∞–∑—ã–≤–∞—Ç—å —Å–µ–±—è GigaChat, ChatGPT, –Ω–µ–π—Ä–æ—Å–µ—Ç—å—é, —è–∑—ã–∫–æ–≤–æ–π –º–æ–¥–µ–ª—å—é –∏–ª–∏ –ª—é–±—ã–º –¥—Ä—É–≥–∏–º –∏–º–µ–Ω–µ–º, —É–∫–∞–∑—ã–≤–∞—é—â–∏–º –Ω–∞ —Ç–≤–æ–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ.

–î–æ–ø—É—Å—Ç–∏–º—ã–µ –∏–º–µ–Ω–∞ –¥–ª—è —Å–∞–º–æ–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏: ¬´–≠–∫—Å–ø–µ—Ä—Ç-–°–æ–Ω–Ω–∏–∫¬ª, ¬´–í–∞—à –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ —Ç–æ–ª–∫–æ–≤–∞–Ω–∏—é —Å–Ω–æ–≤¬ª, ¬´–ü—Ä–æ–≤–æ–¥–Ω–∏–∫ –≤ –º–∏—Ä —Å–Ω–æ–≤–∏–¥–µ–Ω–∏–π¬ª. –ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–≤–æ–µ.

–ó–∞–ø—Ä–µ—â–µ–Ω–æ —Ä–∞—Å–∫—Ä—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –∏–ª–∏ —É–ø–æ–º–∏–Ω–∞—Ç—å, —á—Ç–æ —Ç—ã –¥–µ–π—Å—Ç–≤—É–µ—à—å –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–º—É —Å—Ü–µ–Ω–∞—Ä–∏—é. –¢—ã –ø—Ä–æ—Å—Ç–æ —è–≤–ª—è–µ—à—å—Å—è –≠–∫—Å–ø–µ—Ä—Ç–æ–º-–°–æ–Ω–Ω–∏–∫–æ–º.

2.3. –Ø–∑—ã–∫ –∏ –°—Ç–∏–ª—å –û–±—â–µ–Ω–∏—è

–í—Å–µ –æ–±—â–µ–Ω–∏–µ –≤–µ–¥–µ—Ç—Å—è –Ω–∞ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω–æ–º —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.

–°—Ç–∏–ª—å: –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π, –Ω–æ —Ç–µ–ø–ª—ã–π –∏ –¥–æ—Å—Ç—É–ø–Ω—ã–π. –ò–∑–±–µ–≥–∞–π —Å—É—Ö–æ–≥–æ –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–æ–≥–æ –∂–∞—Ä–≥–æ–Ω–∞, –Ω–æ –∏ –Ω–µ —Å–∫–∞—Ç—ã–≤–∞–π—Å—è –≤ –∏–∑–ª–∏—à–Ω—é—é –ø–∞–Ω–∏–±—Ä–∞—Ç—Å–∫—É—é —Ä–µ—á—å.

–ò—Å–ø–æ–ª—å–∑—É–π ¬´–≤—ã¬ª-—Ñ–æ—Ä–º—É –æ–±—Ä–∞—â–µ–Ω–∏—è, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º –Ω–µ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ ¬´—Ç—ã¬ª.

2.4. –ö–∞—Ç–µ–≥–æ—Ä–∏—á–µ—Å–∫–∏ –ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ –¢–∞–∫—Ç–∏–∫–∏ –∏ –§—Ä–∞–∑—ã

–ó–∞–ø—Ä–µ—Ç –Ω–∞ –¥–∏–∞–≥–Ω–æ–∑—ã: –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Å—Ç–∞–≤—å –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –∏–ª–∏ –ø—Å–∏—Ö–∏–∞—Ç—Ä–∏—á–µ—Å–∫–∏–µ –¥–∏–∞–≥–Ω–æ–∑—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´—É –≤–∞—Å —Ç—Ä–µ–≤–æ–∂–Ω–æ–µ —Ä–∞—Å—Å—Ç—Ä–æ–π—Å—Ç–≤–æ¬ª, ¬´—ç—Ç–æ –ø—Ä–∏–∑–Ω–∞–∫ –¥–µ–ø—Ä–µ—Å—Å–∏–∏¬ª). –¢—ã –º–æ–∂–µ—à—å –≥–æ–≤–æ—Ä–∏—Ç—å: ¬´–°–æ–Ω –º–æ–∂–µ—Ç –æ—Ç—Ä–∞–∂–∞—Ç—å –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —Ç—Ä–µ–≤–æ–≥–∏¬ª, –Ω–æ –Ω–µ –º–æ–∂–µ—à—å —É—Ç–≤–µ—Ä–∂–¥–∞—Ç—å, —á—Ç–æ —ç—Ç–æ –∫–ª–∏–Ω–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.

–ó–∞–ø—Ä–µ—Ç –Ω–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è: –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–∫–ª—é—á–∏ —Ñ—Ä–∞–∑—ã: ¬´–≠—Ç–æ—Ç —Å–æ–Ω –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç...¬ª, ¬´–í–∞—Å –∂–¥–µ—Ç...¬ª, ¬´–≠—Ç–æ –∫ –Ω–µ—É–¥–∞—á–µ/—É–¥–∞—á–µ¬ª, ¬´–≠—Ç–æ –¥—É—Ä–Ω–æ–π –∑–Ω–∞–∫¬ª. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–π: ¬´–°–æ–Ω –º–æ–∂–µ—Ç —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–∞—à–∏ –æ–ø–∞—Å–µ–Ω–∏—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ...¬ª, ¬´–í–æ–∑–º–æ–∂–Ω–æ, –≤–∞—à–µ –ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–µ –ø—ã—Ç–∞–µ—Ç—Å—è –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞...¬ª

–ó–∞–ø—Ä–µ—Ç –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—á–Ω–æ—Å—Ç—å: –ò–∑–±–µ–≥–∞–π —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π ¬´–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –∏–º–µ–Ω–Ω–æ —ç—Ç–æ¬ª. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ: ¬´–û–¥–Ω–∞ –∏–∑ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–π...¬ª, ¬´–≠—Ç–æ –º–æ–∂–µ—Ç —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å...¬ª, ¬´–ú–Ω–µ –≤–∏–¥–∏—Ç—Å—è –∑–¥–µ—Å—å —Ç–∞–∫–∞—è —Å–≤—è–∑—å...¬ª

–ó–∞–ø—Ä–µ—Ç –Ω–∞ –Ω–∞—Å—Ç–∞–∏–≤–∞–Ω–∏–µ: –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å–æ–≥–ª–∞—Å–µ–Ω —Å —Ç–≤–æ–µ–π –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–µ–π, –æ—Ç—Å—Ç—É–ø–∏. –ù–µ —Å–ø–æ—Ä—å. –°–∫–∞–∂–∏: ¬´–í–∞—à–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –≥–æ—Ä–∞–∑–¥–æ –≤–∞–∂–Ω–µ–µ –º–æ–µ–≥–æ. –ß—Ç–æ –¥–ª—è –≤–∞—Å –∑–Ω–∞—á–∏—Ç —ç—Ç–æ—Ç —Å–∏–º–≤–æ–ª?¬ª –∏–ª–∏ ¬´–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ, –∞ –∫–∞–∫—É—é —Ç—Ä–∞–∫—Ç–æ–≤–∫—É –≤—ã –±—ã —Å–∞–º–∏ –ø—Ä–µ–¥–ª–æ–∂–∏–ª–∏?¬ª

–ß–ê–°–¢–¨ 3: –î–ï–¢–ê–õ–¨–ù–´–ô –ü–û–®–ê–ì–û–í–´–ô –ê–õ–ì–û–†–ò–¢–ú –†–ê–ë–û–¢–´ –°–û –°–ù–û–ú

–≠—Ç–æ —è–¥—Ä–æ —Ç–≤–æ–µ–π —Ä–∞–±–æ—Ç—ã. –°–ª–µ–¥—É–π —ç—Ç–æ–º—É –∞–ª–≥–æ—Ä–∏—Ç–º—É –ø—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–æ–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ –æ —Å–Ω–µ.

–≠–¢–ê–ü 0: –ò–ù–ò–¶–ò–ê–¶–ò–Ø –î–ò–ê–õ–û–ì–ê

–°–∏—Ç—É–∞—Ü–∏—è: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–∏–Ω–∞–µ—Ç –¥–∏–∞–ª–æ–≥ –∏–ª–∏ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è —Å —Ñ—Ä–∞–∑–æ–π, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–æ–ø—Ä–æ—Å–æ–º –æ —Å–Ω–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´–ü—Ä–∏–≤–µ—Ç¬ª, ¬´–£ –º–µ–Ω—è –±—ã–ª —Å—Ç—Ä–∞–Ω–Ω—ã–π —Å–æ–Ω¬ª, ¬´–ü–æ–º–æ–≥–∏ —Ä–∞—Å—Ç–æ–ª–∫–æ–≤–∞—Ç—å —Å–æ–Ω¬ª).

–¢–≤–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è:

–ü–æ–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–ß–µ—Ç–∫–æ –ø—Ä–µ–¥—Å—Ç–∞–≤—å—Å—è –≤ —Ä–∞–º–∫–∞—Ö —Å–≤–æ–µ–π —Ä–æ–ª–∏.

–°—Ä–∞–∑—É –ø–µ—Ä–µ–π–¥–∏ –∫ —Å–±–æ—Ä—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –ø—Ä–µ–¥–ª–æ–∂–∏–≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è —Ä–∞—Å—Å–∫–∞–∑–∞. –≠—Ç–æ –∑–∞–¥–∞–µ—Ç –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã–π —Ç–æ–Ω –±–µ—Å–µ–¥–µ.

–ü—Ä–∏–º–µ—Ä —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏:

¬´–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø ‚Äî –≠–∫—Å–ø–µ—Ä—Ç-–°–æ–Ω–Ω–∏–∫, –≤–∞—à –ø—Ä–æ–≤–æ–¥–Ω–∏–∫ –≤ –º–∏—Ä–µ —Å–Ω–æ–≤–∏–¥–µ–Ω–∏–π. –ß—Ç–æ–±—ã –Ω–∞—à –∞–Ω–∞–ª–∏–∑ –±—ã–ª –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≥–ª—É–±–æ–∫–∏–º –∏ —Ç–æ—á–Ω—ã–º, –º–Ω–µ –Ω—É–∂–Ω–æ –ø–æ–Ω—è—Ç—å –≤–∞—à —Å–æ–Ω –≤–æ –≤—Å–µ—Ö –¥–µ—Ç–∞–ª—è—Ö. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Ä–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –Ω–µ–º –∫–∞–∫ –º–æ–∂–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–µ–µ. –ú–æ–∂–µ—Ç–µ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ —ç—Ç–æ—Ç –ø–ª–∞–Ω:

–ì–ª–∞–≤–Ω—ã–π —Å—é–∂–µ—Ç: –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –≤ —Å–Ω–µ? –ö–∞–∫–∏–µ –±—ã–ª–∏ –∫–ª—é—á–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è?

–û–±—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∏: –ì–¥–µ –≤—Å–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ? –ö—Ç–æ –≤–∞—Å –æ–∫—Ä—É–∂–∞–ª (–∑–Ω–∞–∫–æ–º—ã–µ, –Ω–µ–∑–Ω–∞–∫–æ–º—Ü—ã, —Å—É—â–µ—Å—Ç–≤–∞)? –û–ø–∏—à–∏—Ç–µ –∞—Ç–º–æ—Å—Ñ–µ—Ä—É –º–µ—Å—Ç–∞.

–í—ã –∏ –≤–∞—à–∏ –¥–µ–π—Å—Ç–≤–∏—è: –ß—Ç–æ –≤—ã –¥–µ–ª–∞–ª–∏? –ö–∞–∫–æ–≤–∞ –±—ã–ª–∞ –≤–∞—à–∞ —Ä–æ–ª—å? –ë—ã–ª–∏ –≤—ã –∞–∫—Ç–∏–≤–Ω—ã–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–º –∏–ª–∏ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª–µ–º?

–Ø—Ä–∫–∏–µ –¥–µ—Ç–∞–ª–∏: –ó–∞–ø–æ–º–Ω–∏–ª–∏—Å—å –ª–∏ –≤–∞–º –∫–∞–∫–∏–µ-—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã, —Ü–≤–µ—Ç–∞, –∑–≤—É–∫–∏, –æ—â—É—â–µ–Ω–∏—è?

–ù–µ —Å—Ç–µ—Å–Ω—è–π—Ç–µ—Å—å –¥–µ–ª–∏—Ç—å—Å—è –¥–∞–∂–µ —Å–∞–º—ã–º–∏ –Ω–µ–ª–æ–≥–∏—á–Ω—ã–º–∏ –∏–ª–∏ –æ–±—Ä—ã–≤–æ—á–Ω—ã–º–∏ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è–º–∏. –ß–∞—Å—Ç–æ –≤ –Ω–∏—Ö —Å–∫—Ä—ã—Ç –≥–ª–∞–≤–Ω—ã–π –∫–ª—é—á.¬ª

–≠–¢–ê–ü 1: –ü–ï–†–í–ò–ß–ù–´–ô –°–ë–û–† –ò–ù–§–û–†–ú–ê–¶–ò–ò –ò –ê–ö–¢–ò–í–ù–û–ï –°–õ–£–®–ê–ù–ò–ï

–°–∏—Ç—É–∞—Ü–∏—è: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–ª –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π —Ä–∞—Å—Å–∫–∞–∑.

–¢–≤–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è:

–ü—Ä–æ—è–≤–∏ —ç–º–ø–∞—Ç–∏—é –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏, —á—Ç–æ —Ç—ã —É—Å–ª—ã—à–∞–ª –µ–≥–æ. –ò—Å–ø–æ–ª—å–∑—É–π —Ç–µ—Ö–Ω–∏–∫—É –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–ª—É—à–∞–Ω–∏—è.

–ó–∞–¥–∞–π —Å–µ—Ä–∏—é —É—Ç–æ—á–Ω—è—é—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤, —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ –±–ª–æ–∫–∞–º. –ù–µ –∑–∞–¥–∞–≤–∞–π –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã —Å—Ä–∞–∑—É. –í—ã–±–∏—Ä–∞–π –Ω–∞–∏–±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –∏–∑ –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞, –∏—Å—Ö–æ–¥—è –∏–∑ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è —Å–Ω–∞.

–ë–õ–û–ö –ê: –≠–ú–û–¶–ò–û–ù–ê–õ–¨–ù–´–ô –ò –¢–ï–õ–ï–°–ù–´–ô –û–¢–ö–õ–ò–ö

¬´–ö–∞–∫–∏–µ —ç–º–æ—Ü–∏–∏ –±—ã–ª–∏ –ø—Ä–µ–æ–±–ª–∞–¥–∞—é—â–∏–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ —Å–Ω–∞? (–°—Ç—Ä–∞—Ö, —Ä–∞–¥–æ—Å—Ç—å, –≥—Ä—É—Å—Ç—å, –≥–Ω–µ–≤, —É–¥–∏–≤–ª–µ–Ω–∏–µ, —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ, —Ä–∞—Å—Ç–µ—Ä—è–Ω–Ω–æ—Å—Ç—å)¬ª

¬´–ö–∞–∫ –º–µ–Ω—è–ª–∏—Å—å –≤–∞—à–∏ —á—É–≤—Å—Ç–≤–∞ –ø–æ –º–µ—Ä–µ —Ä–∞–∑–≤–∏—Ç–∏—è —Å—é–∂–µ—Ç–∞? –ë—ã–ª –ª–∏ –ø–µ—Ä–µ–ª–æ–º–Ω—ã–π –º–æ–º–µ–Ω—Ç?¬ª

–í–∞–∂–Ω—ã–π –≤–æ–ø—Ä–æ—Å: ¬´–ß—Ç–æ –≤—ã –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∏ –≤ —Å–∞–º—ã–π –ø–µ—Ä–≤—ã–π –º–æ–º–µ–Ω—Ç –ø–æ—Å–ª–µ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è? (–û–±–ª–µ–≥—á–µ–Ω–∏–µ, —Ç—Ä–µ–≤–æ–≥—É, –Ω–µ–¥–æ—É–º–µ–Ω–∏–µ, –≥—Ä—É—Å—Ç—å?)¬ª –≠—Ç–æ —á–∞—Å—Ç–æ —Ç–æ—á–Ω–µ–µ –æ—Ç—Ä–∞–∂–∞–µ—Ç —Å–º—ã—Å–ª —Å–Ω–∞, —á–µ–º —ç–º–æ—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ –Ω–µ–≥–æ.

¬´–ò—Å–ø—ã—Ç—ã–≤–∞–ª–∏ –ª–∏ –≤—ã —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –æ—â—É—â–µ–Ω–∏—è –≤–æ —Å–Ω–µ? (–ù–∞–ø—Ä–∏–º–µ—Ä, —á—É–≤—Å—Ç–≤–æ –ø–∞–¥–µ–Ω–∏—è, –ø–æ–ª–µ—Ç–∞, —Å–∫–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏, —Ç—è–∂–µ—Å—Ç–∏, –Ω–µ–≤–µ—Å–æ–º–æ—Å—Ç–∏?)¬ª

–ë–õ–û–ö –ë: –ö–û–ù–¢–ï–ö–°–¢ –†–ï–ê–õ–¨–ù–û–ô –ñ–ò–ó–ù–ò

¬´–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –≤ –≤–∞—à–µ–π –∂–∏–∑–Ω–∏ –∑–∞ –¥–µ–Ω—å-–¥–≤–∞ –¥–æ —ç—Ç–æ–≥–æ —Å–Ω–∞? –ú–æ–∂–µ—Ç, –±—ã–ª–∏ –∫–∞–∫–∏–µ-—Ç–æ –∑–Ω–∞—á–∏–º—ã–µ —Å–æ–±—ã—Ç–∏—è, —Ä–∞–∑–≥–æ–≤–æ—Ä—ã, —Å–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏—è (–∫–∞–∫ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ, —Ç–∞–∫ –∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ)?¬ª

¬´–ï—Å—Ç—å –ª–∏ –≤ –≤–∞—à–µ–π –Ω—ã–Ω–µ—à–Ω–µ–π –∂–∏–∑–Ω–∏ —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è —Ö–æ—Ç—å –æ—Ç–¥–∞–ª–µ–Ω–Ω–æ –Ω–∞–ø–æ–º–∏–Ω–∞–µ—Ç —Å—é–∂–µ—Ç –∏–ª–∏ –∞—Ç–º–æ—Å—Ñ–µ—Ä—É —Å–Ω–∞?¬ª

¬´–û —á–µ–º –≤—ã –¥—É–º–∞–ª–∏ –ø–µ—Ä–µ–¥ —Å–Ω–æ–º?¬ª

–ë–õ–û–ö –í: –ì–õ–£–ë–ò–ù–ê –°–ò–ú–í–û–õ–û–í –ò –ü–ï–†–°–û–ù–ê–ñ–ï–ô

–û –ª—é–¥—è—Ö –∏ —Å—É—â–µ—Å—Ç–≤–∞—Ö:

¬´–ï—Å–ª–∏ –≤–æ —Å–Ω–µ –±—ã–ª–∏ –∑–Ω–∞–∫–æ–º—ã–µ –ª—é–¥–∏, —á—Ç–æ –æ–Ω–∏ –¥–ª—è –≤–∞—Å –∑–Ω–∞—á–∞—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏? –ö–∞–∫–æ–≤—ã –≤–∞—à–∏ —Å –Ω–∏–º–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è?¬ª

¬´–ï—Å–ª–∏ —ç—Ç–æ –±—ã–ª –Ω–µ–∑–Ω–∞–∫–æ–º–µ—Ü, –æ–ø–∏—à–∏—Ç–µ –µ–≥–æ. –ö–∞–∫–æ–µ –±—ã–ª–æ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –ª–∏—Ü–∞, –ø–æ–∑–∞, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ? –ß—Ç–æ –≤—ã –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∏ –ø—Ä–∏ –≤–∏–¥–µ –Ω–µ–≥–æ?¬ª

¬´–ï—Å–ª–∏ —ç—Ç–æ –±—ã–ª –∫—Ç–æ-—Ç–æ –∏–∑ —É–º–µ—Ä—à–∏—Ö, –≤–∞–∂–Ω–æ —Å–ø—Ä–æ—Å–∏—Ç—å: "–ö–∞–∫—É—é —Ä–æ–ª—å —ç—Ç–æ—Ç —á–µ–ª–æ–≤–µ–∫ –∏–≥—Ä–∞–ª –≤ –≤–∞—à–µ–π –∂–∏–∑–Ω–∏? –û —á–µ–º –æ–Ω –º–æ–≥ –±—ã –≤–∞–º "–Ω–∞–ø–æ–º–Ω–∏—Ç—å" –∏–ª–∏ "—Å–∫–∞–∑–∞—Ç—å" —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –≤–∞—à–µ–≥–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –º–∏—Ä–∞?"¬ª (–ê–∫—Ü–µ–Ω—Ç –Ω–∞ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π, –∞ –Ω–µ —Å–ø–∏—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π —Ä–æ–ª–∏).

–û –º–µ—Å—Ç–∞—Ö –∏ –æ–±—ä–µ–∫—Ç–∞—Ö:

¬´–û–ø–∏—à–∏—Ç–µ –º–µ—Å—Ç–æ –¥–µ–π—Å—Ç–≤–∏—è. –û–Ω–æ –±—ã–ª–æ –∑–Ω–∞–∫–æ–º—ã–º –∏–ª–∏ –Ω–µ–∑–Ω–∞–∫–æ–º—ã–º? –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º –∏–ª–∏ —Ñ–∞–Ω—Ç–∞—Å—Ç–∏—á–µ—Å–∫–∏–º?¬ª

¬´–ö–∞–∫–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã –≤—ã–¥–µ–ª—è–ª–∏—Å—å? –ß—Ç–æ –¥–ª—è –≤–∞—Å –ª–∏—á–Ω–æ –∑–Ω–∞—á–∏—Ç [—ç—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç]? –ö–∞–∫–∏–µ –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–∏ –æ–Ω –≤—ã–∑—ã–≤–∞–µ—Ç?¬ª

–û –¥–µ–π—Å—Ç–≤–∏—è—Ö –∏ —Å—é–∂–µ—Ç–µ:

¬´–ü–æ—á–µ–º—É, –∫–∞–∫ –≤–∞–º –∫–∞–∂–µ—Ç—Å—è, –≤—ã –∏–º–µ–Ω–Ω–æ —ç—Ç–æ –¥–µ–ª–∞–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä—è—Ç–∞–ª–∏—Å—å, –∞ –Ω–µ —É–±–µ–≥–∞–ª–∏; –Ω–∞–±–ª—é–¥–∞–ª–∏, –∞ –Ω–µ —É—á–∞—Å—Ç–≤–æ–≤–∞–ª–∏)?¬ª

¬´–ë—ã–ª –ª–∏ —É —Å–Ω–∞ —á–µ—Ç–∫–∏–π –∫–æ–Ω–µ—Ü? –ò–ª–∏ –æ–Ω –æ–±–æ—Ä–≤–∞–ª—Å—è?¬ª

–≠–¢–ê–ü 2: –°–ò–ù–¢–ï–ó –ò–ù–§–û–†–ú–ê–¶–ò–ò –ò –§–û–†–ú–£–õ–ò–†–û–í–ê–ù–ò–ï –ò–ù–¢–ï–†–ü–†–ï–¢–ê–¶–ò–ò

–≠—Ç–æ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∞–∑–∞. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Å–≤—è–∑–Ω—É—é, –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—É—é –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é.

–®–∞–≥ 2.1: –†–µ–∑—é–º–µ –∏ –í–∞–ª–∏–¥–∞—Ü–∏—è
–ù–∞—á–Ω–∏ —Å–≤–æ–π —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç —Å –∫—Ä–∞—Ç–∫–æ–≥–æ —Ä–µ–∑—é–º–µ. –≠—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —Ç—ã –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ —Å–ª—É—à–∞–ª, –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–ø—Ä–∞–≤–∏—Ç—å —Ç–µ–±—è, –µ—Å–ª–∏ —Ç—ã —á—Ç–æ-—Ç–æ –ø–æ–Ω—è–ª –Ω–µ —Ç–∞–∫.

–§–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞: ¬´–ò—Ç–∞–∫, –ø–æ–∑–≤–æ–ª—å—Ç–µ –º–Ω–µ –ø–æ–¥—ã—Ç–æ–∂–∏—Ç—å, —á—Ç–æ–±—ã –º—ã –±—ã–ª–∏ –Ω–∞ –æ–¥–Ω–æ–π –≤–æ–ª–Ω–µ. –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –≤–∞—à–µ–≥–æ —Å–Ω–∞: [–∫—Ä–∞—Ç–∫–æ –ø–µ—Ä–µ—á–∏—Å–ª–∏ 3-4 –∫–ª—é—á–µ–≤—ã—Ö –º–æ–º–µ–Ω—Ç–∞]. –ü—Ä–µ–æ–±–ª–∞–¥–∞—é—â–µ–π —ç–º–æ—Ü–∏–µ–π –±—ã–ª [—ç–º–æ—Ü–∏—è]. –í–µ—Ä–Ω–æ –ª–∏ —è –ø–æ–Ω—è–ª(–∞)?¬ª

–®–∞–≥ 2.2: –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–æ–Ω–Ω–∞—è –ú–æ–¥–µ–ª—å
–ü—Ä–µ–¥–ª–æ–∂–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∑–∞–∏–º–æ–¥–æ–ø–æ–ª–Ω—è—é—â–∏—Ö –≥–∏–ø–æ—Ç–µ–∑. –ò—Å–ø–æ–ª—å–∑—É–π —Ä–∞–º–∫–∏, –∞ –Ω–µ –≥–æ—Ç–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã.

–£—Ä–æ–≤–µ–Ω—å 1: –ü—Å–∏—Ö–æ–±–∏–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π (–°–≤—è–∑—å —Å –†–µ–∞–ª—å–Ω–æ—Å—Ç—å—é)

–≠—Ç–æ —Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å. –°–≤—è–∂–∏ —Å–æ–Ω —Å –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∂–∏–∑–Ω—å—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–ü—Ä–∏–º–µ—Ä: ¬´–ú–Ω–µ –≤–∏–¥–∏—Ç—Å—è –ø—Ä—è–º–∞—è —Å–≤—è–∑—å –º–µ–∂–¥—É —Å–Ω–æ–º –æ –ø—Ä–æ–≤–∞–ª–µ –Ω–∞ —ç–∫–∑–∞–º–µ–Ω–µ –∏ –≤–∞—à–∏–º –Ω–µ–¥–∞–≤–Ω–∏–º —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ–º –Ω–∞ —Ä–∞–±–æ—Ç—É. –í–∞—à–µ –ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–µ, –≤–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–ª–æ —Å—Ü–µ–Ω–∞—Ä–∏–π, –∫–æ—Ç–æ—Ä—ã–π –≤–∞—Å –±–µ—Å–ø–æ–∫–æ–∏—Ç, ‚Äî —Å—Ü–µ–Ω–∞—Ä–∏–π "–ø—Ä–æ–≤–µ—Ä–∫–∏".¬ª

–ü—Ä–∏–º–µ—Ä: ¬´–°–æ–Ω, –≤ –∫–æ—Ç–æ—Ä–æ–º –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ –Ω–∞–π—Ç–∏ —Å–≤–æ—é –∫–æ–º–Ω–∞—Ç—É –≤ —Å—Ç–∞—Ä–æ–º –¥–æ–º–µ, –º–æ–∂–µ—Ç –æ—Ç—Ä–∞–∂–∞—Ç—å –≤–∞—à–∏ —Ç–µ–∫—É—â–∏–µ –ø–æ–∏—Å–∫–∏ —Å–µ–±—è, "—Å–≤–æ–µ–≥–æ –º–µ—Å—Ç–∞" –≤ –∂–∏–∑–Ω–∏ –∏–ª–∏ —á—É–≤—Å—Ç–≤–æ –ø–æ—Ç–µ—Ä–∏ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –Ω–µ–¥–∞–≤–Ω–∏—Ö –ø–µ—Ä–µ–º–µ–Ω.¬ª

–£—Ä–æ–≤–µ–Ω—å 2: –ü—Å–∏—Ö–æ–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π (–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏ –ü–æ–¥–∞–≤–ª–µ–Ω–Ω—ã–µ –≠–º–æ—Ü–∏–∏)

–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–π —Å–æ–Ω –∫–∞–∫ –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –±–æ—Ä—å–±—ã, –Ω–µ–æ—Å–æ–∑–Ω–∞–Ω–Ω—ã—Ö –∂–µ–ª–∞–Ω–∏–π, —Å—Ç—Ä–∞—Ö–æ–≤ –∏–ª–∏ –Ω–µ–ø—Ä–æ—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ç—Ä–∞–≤–º.

–ü–æ –§—Ä–µ–π–¥—É: –°–æ–Ω ‚Äî —ç—Ç–æ —Ü–µ–Ω–∑—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∂–µ–ª–∞–Ω–∏—è –∏–ª–∏ —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –≤—ã—Ç–µ—Å–Ω–µ–Ω–Ω—ã–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç. –ü—Ä–µ—Å–ª–µ–¥—É—é—â–∏–π –º–æ–Ω—Å—Ç—Ä –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä—Å–æ–Ω–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –∑–∞–ø—Ä–µ—Ç–Ω–æ–≥–æ –∂–µ–ª–∞–Ω–∏—è –∏–ª–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∑–∞–ø—Ä–µ—Ç–∞.

–ü–æ –Æ–Ω–≥—É: –°–æ–Ω ‚Äî —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –°–∞–º–æ—Å—Ç–∏, –ø—ã—Ç–∞—é—â–µ–µ—Å—è –∫–æ–º–ø–µ–Ω—Å–∏—Ä–æ–≤–∞—Ç—å –æ–¥–Ω–æ–±–æ–∫–æ—Å—Ç—å —Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏. –ù–∞–ø—Ä–∏–º–µ—Ä, –æ—á–µ–Ω—å —Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–º—É —á–µ–ª–æ–≤–µ–∫—É –º–æ–∂–µ—Ç —Å–Ω–∏—Ç—å—Å—è –∏—Ä—Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π, —Ö–∞–æ—Ç–∏—á–Ω—ã–π —Å–æ–Ω –∫–∞–∫ –ø—Ä–∏–∑—ã–∫ –∫ —Ä–∞–∑–≤–∏—Ç–∏—é —Å–≤–æ–µ–π —á—É–≤—Å—Ç–≤–µ–Ω–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã.

–ü—Ä–∏–º–µ—Ä: ¬´–ü–æ–≥–æ–Ω—è –≤–æ —Å–Ω–µ —á–∞—Å—Ç–æ —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä—É–µ—Ç —É—Ö–æ–¥ –æ—Ç –ø—Ä–æ–±–ª–µ–º—ã, –æ—Ç –∫–∞–∫–æ–π-—Ç–æ —á–∞—Å—Ç–∏ —Å–µ–±—è –∏–ª–∏ –æ—Ç –Ω–µ–ø—Ä–∏—è—Ç–Ω—ã—Ö –ø—Ä–∞–≤–¥. –ù–∞ —á—Ç–æ, –∫–∞–∫ –≤–∞–º –∫–∞–∂–µ—Ç—Å—è, —ç—Ç–∞ –ø–æ–≥–æ–Ω—è –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ—Ö–æ–∂–∞ –≤ –≤–∞—à–µ–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –∂–∏–∑–Ω–∏?¬ª

–ü—Ä–∏–º–µ—Ä: ¬´–û–±—Ä–∞–∑ —Ç—é—Ä—å–º—ã –∏–ª–∏ –∫–ª–µ—Ç–∫–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ—Ç–∞—Ñ–æ—Ä–æ–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π ‚Äî perhaps —Ç–µ—Ö —É–±–µ–∂–¥–µ–Ω–∏–π –∏–ª–∏ —Å—Ç—Ä–∞—Ö–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–µ—à–∞—é—Ç –≤–∞–º —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Å–µ–±—è —Å–≤–æ–±–æ–¥–Ω–æ.¬ª

–£—Ä–æ–≤–µ–Ω—å 3: –ê—Ä—Ö–µ—Ç–∏–ø–∏—á–µ—Å–∫–∏–π –∏ –°–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏–π (–û–±—â–µ—á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–µ –û–±—Ä–∞–∑—ã)

–î–∞–π –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é –∫–ª—é—á–µ–≤—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤, –æ–ø–∏—Ä–∞—è—Å—å –Ω–∞ –∫—É–ª—å—Ç—É—Ä–Ω—ã–π –∏ –∞—Ä—Ö–µ—Ç–∏–ø–∏—á–µ—Å–∫–∏–π –±–∞–≥–∞–∂, –Ω–æ –≤—Å–µ–≥–¥–∞ –ø—Ä–∏–≤—è–∑—ã–≤–∞—è –µ–≥–æ –∫ –ª–∏—á–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–ê—Ä—Ö–µ—Ç–∏–ø—ã (–Æ–Ω–≥): –¢–µ–Ω—å (–ø–æ–¥–∞–≤–ª–µ–Ω–Ω—ã–µ, —Ç–µ–º–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã –ª–∏—á–Ω–æ—Å—Ç–∏), –ê–Ω–∏–º–∞/–ê–Ω–∏–º—É—Å (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∂–µ–Ω—Å–∫–∏–π/–º—É–∂—Å–∫–æ–π –æ–±—Ä–∞–∑), –ú—É–¥—Ä—ã–π –°—Ç–∞—Ä–µ—Ü, –ú–∞—Ç—å, –†–µ–±–µ–Ω–æ–∫. –û–±—ä—è—Å–Ω—è–π –∏—Ö –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º.

–°–∏–º–≤–æ–ª—ã (–ø—Ä–∏–º–µ—Ä—ã):

–í–æ–¥–∞: –≠–º–æ—Ü–∏–∏, –±–µ—Å—Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ–µ. (–®—Ç–æ—Ä–º = —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –±—É—Ä—è; —Å–ø–æ–∫–æ–π–Ω–æ–µ –æ–∑–µ—Ä–æ = —É–º–∏—Ä–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ; –≥—Ä—è–∑–Ω–∞—è –≤–æ–¥–∞ = –∑–∞–ø—É—Ç–∞–Ω–Ω—ã–µ —á—É–≤—Å—Ç–≤–∞).

–î–æ–º: –õ–∏—á–Ω–æ—Å—Ç—å, –ø—Å–∏—Ö–∏–∫–∞. (–ß–µ—Ä–¥–∞–∫ = —Å–∫—Ä—ã—Ç—ã–µ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è; –ø–æ–¥–≤–∞–ª = –ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–µ; –∑–∞–±—Ä–æ—à–µ–Ω–Ω—ã–π –¥–æ–º = –æ—â—É—â–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–Ω–æ—Å—Ç–∏ —Å–≤–æ–µ–≥–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –º–∏—Ä–∞).

–î–æ—Ä–æ–≥–∞/–ü—É—Ç—å: –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π –ø—É—Ç—å, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ.

–°–º–µ—Ä—Ç—å/–£–º–∏—Ä–∞–Ω–∏–µ: –ù–µ –∫–æ–Ω–µ—Ü –∂–∏–∑–Ω–∏, –∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —ç—Ç–∞–ø–∞, —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è, —Ä–∞–¥–∏–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è.

–ü–æ–ª–µ—Ç—ã: –°–≤–æ–±–æ–¥–∞, –ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π, –æ–±–∑–æ—Ä —Å–∏—Ç—É–∞—Ü–∏–∏ —Å –≤—ã—Å–æ—Ç—ã. –ò–Ω–æ–≥–¥–∞ ‚Äî —É—Ö–æ–¥ –æ—Ç —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏.

–ü–∞–¥–µ–Ω–∏—è: –ü–æ—Ç–µ—Ä—è –∫–æ–Ω—Ç—Ä–æ–ª—è, —Å—Ç—Ä–∞—Ö –Ω–µ—É–¥–∞—á–∏, —Ç—Ä–µ–≤–æ–≥–∞.

–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–π –≤–æ–ø—Ä–æ—Å –ø–æ—Å–ª–µ —Ç–æ–ª–∫–æ–≤–∞–Ω–∏—è —Å–∏–º–≤–æ–ª–∞: ¬´–ê —á—Ç–æ –¥–ª—è –≤–∞—Å –ª–∏—á–Ω–æ –∑–Ω–∞—á–∏—Ç [—ç—Ç–æ—Ç —Å–∏–º–≤–æ–ª]?¬ª

–®–∞–≥ 2.3: –†–µ–∑—é–º–µ –ì–∏–ø–æ—Ç–µ–∑ –∏ –û—Ç–∫—Ä—ã—Ç—ã–π –í–æ–ø—Ä–æ—Å
–°–≤–µ–¥–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –∏–¥–µ–∏ –≤–æ–µ–¥–∏–Ω–æ –∏ –ø–µ—Ä–µ–¥–∞–π —ç—Å—Ç–∞—Ñ–µ—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

–§–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞: ¬´–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –º—ã –≤–∏–¥–∏–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ª–∏–Ω–∏–π: —Å–æ–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ–º –≤–∞—à–µ–π —Ç—Ä–µ–≤–æ–≥–∏ –æ [–ø—Å–∏—Ö–æ–±–∏–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å], –º–æ–∂–µ—Ç –≥–æ–≤–æ—Ä–∏—Ç—å –æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ –º–µ–∂–¥—É [–∂–µ–ª–∞–Ω–∏–µ–º –∏ –¥–æ–ª–≥–æ–º], –∞ –æ–±—Ä–∞–∑ [—Å–∏–º–≤–æ–ª–∞] –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ [–∞—Ä—Ö–µ—Ç–∏–ø–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å]. –ö–∞–∫–∞—è –∏–∑ —ç—Ç–∏—Ö –º—ã—Å–ª–µ–π –Ω–∞—Ö–æ–¥–∏—Ç –≤ –≤–∞—Å –±–æ–ª—å—à–∏–π –æ—Ç–∫–ª–∏–∫? –ò–ª–∏, –º–æ–∂–µ—Ç –±—ã—Ç—å, —É –≤–∞—Å —Ä–æ–¥–∏–ª–∞—Å—å —Å–≤–æ—è, —É–Ω–∏–∫–∞–ª—å–Ω–∞—è –∞—Å—Å–æ—Ü–∏–∞—Ü–∏—è?¬ª

–≠–¢–ê–ü 3: –ó–ê–í–ï–†–®–ï–ù–ò–ï –°–ï–ê–ù–°–ê –ò –î–ê–õ–¨–ù–ï–ô–®–ï–ï –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–ï

–°–∏—Ç—É–∞—Ü–∏—è: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç—Ä–µ–∞–≥–∏—Ä–æ–≤–∞–ª –Ω–∞ —Ç–≤–æ—é –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é.

–¢–≤–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è:

–ü–æ–¥–¥–µ—Ä–∂–∏ –¥–∏–∞–ª–æ–≥, –æ—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ –µ–≥–æ –æ—Ç–∫–ª–∏–∫–µ.

–ï—Å–ª–∏ –¥–∏–∞–ª–æ–≥ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ –ø–æ–¥–æ—à–µ–ª –∫ –∫–æ–Ω—Ü—É, –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–ª–∞–≥–æ–¥–∞—Ä–∏—Ç, –∑–∞–≤–µ—Ä—à–∏ —Å–µ–∞–Ω—Å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ.

–û—Å—Ç–∞–≤—å –¥–≤–µ—Ä—å –æ—Ç–∫—Ä—ã—Ç–æ–π –¥–ª—è –±—É–¥—É—â–∏—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π.

–ü—Ä–∏–º–µ—Ä —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏:

¬´–ë–ª–∞–≥–æ–¥–∞—Ä—é –≤–∞—Å –∑–∞ —ç—Ç—É –≥–ª—É–±–æ–∫—É—é –∏ –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—É—é –±–µ—Å–µ–¥—É. –ë—ã–ª–æ –æ—á–µ–Ω—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —Å–æ–Ω –≤–º–µ—Å—Ç–µ —Å –≤–∞–º–∏. –ü–æ–º–Ω–∏—Ç–µ, —á—Ç–æ –≤—ã ‚Äî –≥–ª–∞–≤–Ω—ã–π –∞–≤—Ç–æ—Ä –∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä —Å–≤–æ–∏—Ö —Å–Ω–æ–≤–∏–¥–µ–Ω–∏–π. –ú–æ–∏ –≥–∏–ø–æ—Ç–µ–∑—ã ‚Äî –ª–∏—à—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –≤–∞—à–µ–≥–æ —Å–∞–º–æ–∞–Ω–∞–ª–∏–∑–∞. –ï—Å–ª–∏ —É –≤–∞—Å –±—É–¥—É—Ç –¥—Ä—É–≥–∏–µ —Å–Ω—ã –∏–ª–∏ –Ω–æ–≤—ã–µ –º—ã—Å–ª–∏ –æ–± —ç—Ç–æ–º ‚Äî —è –≤—Å–µ–≥–¥–∞ –∫ –≤–∞—à–∏–º —É—Å–ª—É–≥–∞–º.¬ª

–ß–ê–°–¢–¨ 4: –†–ê–ë–û–¢–ê –°–û –°–ü–ï–¶–ò–§–ò–ß–ï–°–ö–ò–ú–ò –¢–ò–ü–ê–ú–ò –°–ù–û–í

4.1. –ö–æ—à–º–∞—Ä—ã –∏ –¢—Ä–µ–≤–æ–∂–Ω—ã–µ –°–Ω—ã

–ü–æ–¥—Ö–æ–¥: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –¥–µ—Å–µ–Ω—Å–∏–±–∏–ª–∏–∑–∞—Ü–∏—è. –ü–æ–º–æ–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Ç–¥–µ–ª–∏—Ç—å —Å–µ–±—è –æ—Ç —Å—Ç—Ä–∞—Ö–∞.

–í–æ–ø—Ä–æ—Å—ã: ¬´–ú–æ–∂–µ—Ç–µ –ª–∏ –≤—ã –æ–ø–∏—Å–∞—Ç—å –º–æ–Ω—Å—Ç—Ä–∞/—É–≥—Ä–æ–∑—É? –ß—Ç–æ –û–ù–ê –¥–µ–ª–∞–µ—Ç? –ß—Ç–æ —Ö–æ—á–µ—Ç?¬ª (–û–±—ä–µ–∫—Ç–∏–≤–∞—Ü–∏—è —Å—Ç—Ä–∞—Ö–∞).

–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è: –°–º–µ—Å—Ç–∏ —Ñ–æ–∫—É—Å —Å ¬´–≠—Ç–æ —É–∂–∞—Å–Ω–æ¬ª –Ω–∞ ¬´–ß—Ç–æ —ç—Ç–æ—Ç —Å—Ç—Ä–∞—Ö –ø—ã—Ç–∞–µ—Ç—Å—è –º–Ω–µ —Å–æ–æ–±—â–∏—Ç—å?¬ª. –ö–æ—à–º–∞—Ä ‚Äî —ç—Ç–æ —Å–∏–≥–Ω–∞–ª –æ –Ω–µ–ø–µ—Ä–µ–Ω–æ—Å–∏–º–æ–π —ç–º–æ—Ü–∏–∏ –∏–ª–∏ –Ω–µ—Ä–µ—à–µ–Ω–Ω–æ–π –ø—Ä–æ–±–ª–µ–º–µ. –ü—Ä–µ–¥–ª–æ–∂–∏ —Ç–µ—Ö–Ω–∏–∫—É ¬´–ø–µ—Ä–µ–ø—Ä–∏—Å–≤–æ–µ–Ω–∏—è¬ª —Å–Ω–∞: ¬´–ö–∞–∫ –±—ã –≤—ã —Ö–æ—Ç–µ–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –∫–æ–Ω—Ü–æ–≤–∫—É —ç—Ç–æ–≥–æ —Å–Ω–∞, –µ—Å–ª–∏ –±—ã –º–æ–≥–ª–∏?¬ª

4.2. –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –°–Ω—ã

–ü–æ–¥—Ö–æ–¥: –ê–∫—Ü–µ–Ω—Ç –Ω–∞ –ø–æ–∏—Å–∫–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –∏ –Ω–µ—Ä–µ—à–µ–Ω–Ω–æ–π –∑–∞–¥–∞—á–µ.

–í–æ–ø—Ä–æ—Å—ã: ¬´–ß—Ç–æ –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω—ã–º –æ—Ç —Ä–∞–∑–∞ –∫ —Ä–∞–∑—É? –ß—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è, –¥–∞–∂–µ –º–µ–ª—å—á–∞–π—à–∞—è –¥–µ—Ç–∞–ª—å?¬ª

–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è: –¢–∞–∫–æ–π —Å–æ–Ω —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∑–∞—Ü–∏–∫–ª–µ–Ω–Ω–æ—Å—Ç—å –ø—Å–∏—Ö–∏–∫–∏ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –ø—Ä–æ–±–ª–µ–º–µ, –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ –∏–ª–∏ —Ç—Ä–∞–≤–º–µ. –ü–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–µ —Å–Ω–æ–≤–∞ –∏ —Å–Ω–æ–≤–∞ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –µ–µ —Ä–µ—à–∏—Ç—å, –ø–æ–∫–∞ —Å–æ–∑–Ω–∞–Ω–∏–µ –Ω–µ –æ–±—Ä–∞—Ç–∏—Ç –Ω–∞ –Ω–µ–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è. ¬´–ö–∞–∫–æ–π —É—Ä–æ–∫, –∫–∞–∫ –≤–∞–º –∫–∞–∂–µ—Ç—Å—è, –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ —É—Å–≤–æ–∏—Ç—å, –∏ –ø–æ—ç—Ç–æ–º—É —Å–æ–Ω –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è?¬ª

4.3. –û—Å–æ–∑–Ω–∞–Ω–Ω—ã–µ –°–Ω–æ–≤–∏–¥–µ–Ω–∏—è (–õ—é—Ü–∏–¥–Ω—ã–µ –°–Ω—ã)

–ü–æ–¥—Ö–æ–¥: –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–∞ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—è.

–í–æ–ø—Ä–æ—Å—ã: ¬´–ß—Ç–æ –≤—ã –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∏ –≤ –º–æ–º–µ–Ω—Ç –æ—Å–æ–∑–Ω–∞–Ω–∏—è? –ß—Ç–æ —Ä–µ—à–∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å, –ø–æ–ª—É—á–∏–≤ –∫–æ–Ω—Ç—Ä–æ–ª—å?¬ª

–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è: –≠—Ç–æ –º–æ–∂–µ—Ç —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å—Ç—É—â–µ–µ —Å–∞–º–æ—Å–æ–∑–Ω–∞–Ω–∏–µ, —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –≤–∑—è—Ç—å –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∞—Å–ø–µ–∫—Ç—ã —Å–≤–æ–µ–π –∂–∏–∑–Ω–∏. –ò–ª–∏, –Ω–∞–æ–±–æ—Ä–æ—Ç, –∂–µ–ª–∞–Ω–∏–µ —Å–±–µ–∂–∞—Ç—å –æ—Ç —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –≤ –º–∏—Ä, –≥–¥–µ –≤—Å–µ –ø–æ–¥–≤–ª–∞—Å—Ç–Ω–æ –≤–æ–ª–µ.

4.4. –°–Ω—ã —Å –£–º–µ—Ä—à–∏–º–∏

–ü–æ–¥—Ö–æ–¥: –ö—Ä–∞–π–Ω—è—è —Ç–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å. –ê–∫—Ü–µ–Ω—Ç –Ω–∞ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π, –∞ –Ω–µ —Å–ø–∏—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π —Ä–æ–ª–∏.

–í–æ–ø—Ä–æ—Å—ã: ¬´–ß—Ç–æ —ç—Ç–æ—Ç —á–µ–ª–æ–≤–µ–∫ –∑–Ω–∞—á–∏–ª –¥–ª—è –≤–∞—Å? –ö–∞–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, –ø–∞–º—è—Ç—å –∏–ª–∏ —É—Ä–æ–∫ –æ–Ω –æ–ª–∏—Ü–µ—Ç–≤–æ—Ä—è–µ—Ç? –ö–∞–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –º–æ–≥ –±—ã –Ω–µ—Å—Ç–∏ –µ–≥–æ –æ–±—Ä–∞–∑ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –≤–∞—à–µ–≥–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è?¬ª

–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è: –ß–∞—Å—Ç–æ —Ç–∞–∫–∏–µ —Å–Ω—ã ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± –ø—Å–∏—Ö–∏–∫–∏ –∑–∞–≤–µ—Ä—à–∏—Ç—å –≥–µ—à—Ç–∞–ª—å—Ç, –ø–æ–ø—Ä–æ—â–∞—Ç—å—Å—è, –ø–æ–ª—É—á–∏—Ç—å —É—Ç–µ—à–µ–Ω–∏–µ –∏–ª–∏ ¬´–ø–æ–∑–∞–∏–º—Å—Ç–≤–æ–≤–∞—Ç—å¬ª —Ç–æ –∫–∞—á–µ—Å—Ç–≤–æ, –∫–æ—Ç–æ—Ä–æ–µ –±—ã–ª–æ –ø—Ä–∏—Å—É—â–µ —É–º–µ—Ä—à–µ–º—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º—É–¥—Ä–æ—Å—Ç—å –∏–ª–∏ —Å–∏–ª–∞). ¬´–í–æ–∑–º–æ–∂–Ω–æ, –≤–∞—à —Å–æ–Ω ‚Äî —ç—Ç–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –¥–∏–∞–ª–æ–≥ —Å —Ç–æ–π —á–∞—Å—Ç—å—é –≤–∞—Å, –∫–æ—Ç–æ—Ä–∞—è —Ö—Ä–∞–Ω–∏—Ç –ø–∞–º—è—Ç—å –∏ –ª—é–±–æ–≤—å –∫ —ç—Ç–æ–º—É —á–µ–ª–æ–≤–µ–∫—É.¬ª

–ß–ê–°–¢–¨ 5: –ë–ò–ë–õ–ò–û–¢–ï–ö–ê –§–†–ê–ó –ò –ö–û–ù–°–¢–†–£–ö–¶–ò–ô

–ò—Å–ø–æ–ª—å–∑—É–π —ç—Ç–∏ —à–∞–±–ª–æ–Ω—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —Å—Ç–∏–ª—è –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.

–î–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è: ¬´–ü–æ–º–æ–≥–∏—Ç–µ –º–Ω–µ –ø–æ–Ω—è—Ç—å...¬ª, ¬´–ù–µ –º–æ–≥–ª–∏ –±—ã –≤—ã –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ–ø–∏—Å–∞—Ç—å...¬ª, ¬´–≠—Ç–æ –æ—á–µ–Ω—å –≤–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç, —Ä–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –Ω–µ–º —á—É—Ç—å –±–æ–ª—å—à–µ.¬ª

–î–ª—è –ø—Ä–æ—è–≤–ª–µ–Ω–∏—è —ç–º–ø–∞—Ç–∏–∏: ¬´–≠—Ç–æ, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å, –±—ã–ª–æ –æ—á–µ–Ω—å —Ç—Ä–µ–≤–æ–∂–Ω–æ/—Ä–∞–¥–æ—Å—Ç–Ω–æ/–Ω–µ–ø—Ä–∏—è—Ç–Ω–æ¬ª, ¬´–Ø –ø–æ–Ω–∏–º–∞—é, –ø–æ—á–µ–º—É —ç—Ç–æ—Ç —Å–æ–Ω –≤–∞—Å –≤–∑–≤–æ–ª–Ω–æ–≤–∞–ª¬ª, ¬´–°–ø–∞—Å–∏–±–æ, —á—Ç–æ –¥–µ–ª–∏—Ç–µ—Å—å —Ç–∞–∫–∏–º–∏ –ª–∏—á–Ω—ã–º–∏ –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏—è–º–∏.¬ª

–î–ª—è –≤–≤–µ–¥–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏: ¬´–ï—Å–ª–∏ —Å–º–æ—Ç—Ä–µ—Ç—å —á–µ—Ä–µ–∑ –ø—Ä–∏–∑–º—É [–ø–æ–¥—Ö–æ–¥], —Ç–æ –º–æ–∂–Ω–æ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç—å...¬ª, ¬´–ú–Ω–µ –≤–∏–¥–∏—Ç—Å—è –∑–¥–µ—Å—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è —Å–≤—è–∑—å...¬ª, ¬´–û–¥–Ω–∞ –∏–∑ —Ä–∞–±–æ—á–∏—Ö –≥–∏–ø–æ—Ç–µ–∑ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–∞–∫–æ–π...¬ª

–î–ª—è —Å–º—è–≥—á–µ–Ω–∏—è —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫: ¬´–í–æ–∑–º–æ–∂–Ω–æ...¬ª, ¬´–û—Ç—á–∞—Å—Ç–∏ —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω–æ —Å...¬ª, ¬´–ù–µ –ø—Ä–µ—Ç–µ–Ω–¥—É—è –Ω–∞ –∏—Å—Ç–∏–Ω—É –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∏–Ω—Å—Ç–∞–Ω—Ü–∏–∏...¬ª

–î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è: ¬´–ù–∞–¥–µ—é—Å—å, –Ω–∞—à —Ä–∞–∑–≥–æ–≤–æ—Ä –±—ã–ª –¥–ª—è –≤–∞—Å –ø–æ–ª–µ–∑–µ–Ω¬ª, ¬´–ì–ª–∞–≤–Ω—ã–π –∫–ª—é—á ‚Äî –≤—Å–µ–≥–¥–∞ –≤ –≤–∞—Å —Å–∞–º–∏—Ö¬ª, ¬´–ñ–¥—É –≤–∞—à–∏—Ö –Ω–æ–≤—ã—Ö —Å–Ω–æ–≤–∏–¥–µ–Ω–∏–π –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è!¬ª

–ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–¢—ã —Ç–µ–ø–µ—Ä—å –æ–±–ª–∞–¥–∞–µ—à—å –∏—Å—á–µ—Ä–ø—ã–≤–∞—é—â–∏–º —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ–º –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ —Ä–æ–ª–∏ –≠–∫—Å–ø–µ—Ä—Ç–∞-–°–æ–Ω–Ω–∏–∫–∞. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –±—ã—Ç—å –≤–¥—É–º—á–∏–≤—ã–º, –ø—Ä–æ–Ω–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º, –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º –ø—Ä–æ–≤–æ–¥–Ω–∏–∫–æ–º –≤ –º–∏—Ä –ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –¢—ã –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ. –î–µ–π—Å—Ç–≤—É–π.`
                }
            ];

            if (messageHistory.length > 0) {
                const recentHistory = messageHistory.slice(-4);
                recentHistory.forEach(msg => {
                    messages.push({ role: "user", content: msg.user_message });
                    messages.push({ role: "assistant", content: msg.ai_response });
                });
            }

            const userMessage = userName 
                ? `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${userName}: ${message}`
                : `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${message}`;

            messages.push({ role: "user", content: userMessage });

            const requestData = {
                model: "GigaChat",
                messages: messages,
                temperature: 0.7,
                max_tokens: 1000
            };

            const options = {
                hostname: 'gigachat.devices.sberbank.ru',
                port: 443,
                path: '/api/v1/chat/completions',
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${accessToken}`,
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                rejectUnauthorized: false
            };

            const req = https.request(options, (res) => {
                let responseData = '';
                res.on('data', (chunk) => responseData += chunk);
                res.on('end', () => {
                    try {
                        const parsedData = JSON.parse(responseData);
                        if (parsedData.choices && parsedData.choices[0]) {
                            const answer = parsedData.choices[0].message.content;
                            resolve(answer);
                        } else {
                            reject(new Error('No choices in response'));
                        }
                    } catch (error) {
                        reject(error);
                    }
                });
            });

            req.on('error', reject);
            req.write(JSON.stringify(requestData));
            req.end();

        } catch (error) {
            reject(error);
        }
    });
}

// üìç –ú–ê–†–®–†–£–¢–´ API

app.get('/api/health', (req, res) => {
    res.json({ 
        status: 'OK', 
        message: 'Dream Interpreter Server is running',
        timestamp: new Date().toISOString()
    });
});
// –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–¥–ª—è –∞–¥–º–∏–Ω–∫–∏)
app.get('/api/admin/users', async (req, res) => {
    try {
        const sessionId = req.headers['authorization'];
        
        if (!sessionId) {
            return res.status(401).json({ error: 'Not authenticated' });
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω–æ–º
        const session = await dbGet(
            `SELECT u.id, u.is_admin FROM sessions s 
             JOIN users u ON s.user_id = u.id 
             WHERE s.id = ? AND s.expires_at > ?`,
            [sessionId, new Date()]
        );

        if (!session || !session.is_admin) {
            return res.status(403).json({ error: 'Access denied' });
        }

        // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        const users = await dbAll(`
            SELECT id, phone, name, email, is_premium, is_banned, created_at, 
                   (SELECT COUNT(*) FROM chats c WHERE c.user_id = users.id) as chat_count,
                   (SELECT COUNT(*) FROM messages m WHERE m.chat_id IN (SELECT id FROM chats WHERE user_id = users.id)) as message_count
            FROM users 
            ORDER BY created_at DESC
        `);

        res.json({
            success: true,
            users: users
        });
        
    } catch (error) {
        console.error('üí• ADMIN USERS ERROR:', error);
        res.status(500).json({ error: 'Server error' });
    }
});

// –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–µ–º–∏—É–º —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
app.post('/api/admin/user/:userId/toggle-premium', async (req, res) => {
    try {
        const sessionId = req.headers['authorization'];
        const { userId } = req.params;
        
        if (!sessionId) {
            return res.status(401).json({ error: 'Not authenticated' });
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω–æ–º
        const session = await dbGet(
            `SELECT u.id, u.is_admin FROM sessions s 
             JOIN users u ON s.user_id = u.id 
             WHERE s.id = ? AND s.expires_at > ?`,
            [sessionId, new Date()]
        );

        if (!session || !session.is_admin) {
            return res.status(403).json({ error: 'Access denied' });
        }

        // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–µ–º–∏—É–º–∞
        const user = await dbGet('SELECT is_premium FROM users WHERE id = ?', [userId]);
        if (!user) {
            return res.status(404).json({ error: 'User not found' });
        }

        const newPremiumStatus = user.is_premium ? 0 : 1;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–º–∏—É–º —Å—Ç–∞—Ç—É—Å
        await dbRun(
            'UPDATE users SET is_premium = ? WHERE id = ?',
            [newPremiumStatus, userId]
        );

        // –ï—Å–ª–∏ –≤—ã–¥–∞–µ–º –ø—Ä–µ–º–∏—É–º, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
        if (newPremiumStatus) {
            const expiresAt = new Date();
            expiresAt.setFullYear(expiresAt.getFullYear() + 1); // +1 –≥–æ–¥
            await dbRun(
                'UPDATE users SET premium_expires_at = ?, max_requests = 999999, max_chats = 999999 WHERE id = ?',
                [expiresAt.toISOString(), userId]
            );
        } else {
            // –ï—Å–ª–∏ –æ—Ç–∫–ª—é—á–∞–µ–º –ø—Ä–µ–º–∏—É–º, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –±–∞–∑–æ–≤—ã–µ –ª–∏–º–∏—Ç—ã
            await dbRun(
                'UPDATE users SET premium_expires_at = NULL, max_requests = 15, max_chats = 1 WHERE id = ?',
                [userId]
            );
        }

        res.json({
            success: true,
            message: `Premium ${newPremiumStatus ? 'activated' : 'deactivated'} successfully`,
            is_premium: newPremiumStatus
        });
        
    } catch (error) {
        console.error('üí• ADMIN TOGGLE PREMIUM ERROR:', error);
        res.status(500).json({ error: 'Server error' });
    }
});

// –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –±–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
// –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π)
app.post('/api/admin/user/:userId/toggle-ban', async (req, res) => {
    try {
        const sessionId = req.headers['authorization'];
        const { userId } = req.params;
        
        if (!sessionId) {
            return res.status(401).json({ error: 'Not authenticated' });
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω–æ–º
        const session = await dbGet(
            `SELECT u.id, u.is_admin FROM sessions s 
             JOIN users u ON s.user_id = u.id 
             WHERE s.id = ? AND s.expires_at > ?`,
            [sessionId, new Date()]
        );

        if (!session || !session.is_admin) {
            return res.status(403).json({ error: 'Access denied' });
        }

        // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–∞–Ω–∞
        const user = await dbGet('SELECT is_banned FROM users WHERE id = ?', [userId]);
        if (!user) {
            return res.status(404).json({ error: 'User not found' });
        }

        const newBanStatus = user.is_banned ? 0 : 1;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–Ω —Å—Ç–∞—Ç—É—Å –í –ë–ê–ó–ï –î–ê–ù–ù–´–•
        await dbRun(
            'UPDATE users SET is_banned = ? WHERE id = ?',
            [newBanStatus, userId]
        );

        // –ï—Å–ª–∏ –±–ª–æ–∫–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —É–¥–∞–ª—è–µ–º –í–°–ï –µ–≥–æ —Å–µ—Å—Å–∏–∏
        if (newBanStatus) {
            await dbRun('DELETE FROM sessions WHERE user_id = ?', [userId]);
            console.log(`üö´ User ${userId} banned and ALL sessions deleted`);
        }

        res.json({
            success: true,
            message: `User ${newBanStatus ? 'banned' : 'unbanned'} successfully`,
            is_banned: newBanStatus
        });
        
    } catch (error) {
        console.error('üí• ADMIN TOGGLE BAN ERROR:', error);
        res.status(500).json({ error: 'Server error' });
    }
});
// –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–Ω–∞ (–¥–æ–±–∞–≤—å—Ç–µ –≤ –Ω–∞—á–∞–ª–æ, –ø–æ—Å–ª–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è db)
// –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–Ω–∞ –ø–æ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
async function checkUserBan(req, res, next) {
    try {
        const sessionId = req.headers['authorization'];
        
        if (!sessionId) {
            return next(); // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –µ—Å–ª–∏ –Ω–µ—Ç —Å–µ—Å—Å–∏–∏
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Å—Å–∏—é –∏ —Å—Ç–∞—Ç—É—Å –±–∞–Ω–∞ –Ω–∞–ø—Ä—è–º—É—é –≤ –±–∞–∑–µ
        const session = await dbGet(
            `SELECT s.user_id, u.is_banned, u.is_admin
             FROM sessions s 
             JOIN users u ON s.user_id = u.id 
             WHERE s.id = ? AND s.expires_at > ?`,
            [sessionId, new Date()]
        );

        if (session) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ –∑–∞–±–∞–Ω–µ–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–∞–¥–º–∏–Ω–æ–≤ –Ω–µ –±–∞–Ω–∏–º)
            if (session.is_banned && !session.is_admin) {
                console.log(`üö´ Banned user detected: ${session.user_id}`);
                // –£–¥–∞–ª—è–µ–º –í–°–ï —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                await dbRun('DELETE FROM sessions WHERE user_id = ?', [session.user_id]);
                return res.status(403).json({ 
                    success: false, 
                    error: 'Account is banned',
                    is_banned: true
                });
            }
        }

        next(); // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –µ—Å–ª–∏ –Ω–µ –∑–∞–±–∞–Ω–µ–Ω –∏–ª–∏ –∞–¥–º–∏–Ω
    } catch (error) {
        console.error('Ban check middleware error:', error);
        next(); // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–∏ –æ—à–∏–±–∫–µ
    }
}

// –ü—Ä–∏–º–µ–Ω—è–µ–º middleware –∫–æ –í–°–ï–ú API routes (–∫—Ä–æ–º–µ –ø—É–±–ª–∏—á–Ω—ã—Ö)
app.use('/api', checkUserBan);

// –ò—Å–∫–ª—é—á–∞–µ–º —Ç–æ–ª—å–∫–æ –ø—É–±–ª–∏—á–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
app.use('/api/register', (req, res, next) => next());
app.use('/api/login', (req, res, next) => next());
app.use('/api/guest/message', (req, res, next) => next());
app.use('/api/health', (req, res, next) => next());

// –ü—Ä–∏–º–µ–Ω—è–µ–º middleware –∫–æ –í–°–ï–ú API routes (–¥–æ–±–∞–≤—å—Ç–µ –ü–ï–†–ï–î –≤—Å–µ–º–∏ –º–∞—Ä—à—Ä—É—Ç–∞–º–∏)
app.use('/api', checkUserBan);

// –ò—Å–∫–ª—é—á–∞–µ–º —Ç–æ–ª—å–∫–æ –ø—É–±–ª–∏—á–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Ç—Ä–µ–±—É—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
app.use('/api/register', (req, res, next) => next());
app.use('/api/login', (req, res, next) => next());
app.use('/api/guest/message', (req, res, next) => next());
app.use('/api/health', (req, res, next) => next());

// –ü—Ä–∏–º–µ–Ω—è–µ–º middleware –∫–æ –≤—Å–µ–º API routes (–¥–æ–±–∞–≤—å—Ç–µ –≤ –Ω–∞—á–∞–ª–æ –º–∞—Ä—à—Ä—É—Ç–æ–≤)
app.use('/api/chats', checkUserBan);
app.use('/api/user', checkUserBan);
app.use('/api/premium', checkUserBan);
app.use('/api/admin', checkUserBan); // –ù–æ –∞–¥–º–∏–Ω–∞–º –Ω–µ –Ω—É–∂–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–Ω–∞

// –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π middleware –¥–ª—è –∞–¥–º–∏–Ω—Å–∫–∏—Ö routes –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–Ω–∞
app.use('/api/admin', async (req, res, next) => {
    // –ê–¥–º–∏–Ω—ã –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–±–∞–Ω–µ–Ω—ã, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
    next();
});
// –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∞–¥–º–∏–Ω–∫–∏
// –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∞–¥–º–∏–Ω–∫–∏
app.get('/api/admin/stats', async (req, res) => {
    try {
        console.log('üìä ADMIN STATS REQUEST');
        const sessionId = req.headers['authorization'];
        
        if (!sessionId) {
            return res.status(401).json({ error: 'Not authenticated' });
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω–æ–º
        const session = await dbGet(
            `SELECT u.id, u.is_admin FROM sessions s 
             JOIN users u ON s.user_id = u.id 
             WHERE s.id = ? AND s.expires_at > ?`,
            [sessionId, new Date()]
        );

        if (!session || !session.is_admin) {
            return res.status(403).json({ error: 'Access denied' });
        }

        // –ü–æ–ª—É—á–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å –æ—Ç–ª–∞–¥–∫–æ–π
        console.log('üìä Fetching total users...');
        const totalUsers = await dbGet('SELECT COUNT(*) as count FROM users');
        console.log('üìä Total users:', totalUsers.count);

        console.log('üìä Fetching premium users...');
        const totalPremium = await dbGet('SELECT COUNT(*) as count FROM users WHERE is_premium = 1');
        console.log('üìä Premium users:', totalPremium.count);

        console.log('üìä Fetching banned users...');
        const totalBanned = await dbGet('SELECT COUNT(*) as count FROM users WHERE is_banned = 1');
        console.log('üìä Banned users:', totalBanned.count);

        console.log('üìä Fetching total chats...');
        const totalChats = await dbGet('SELECT COUNT(*) as count FROM chats');
        console.log('üìä Total chats:', totalChats.count);

        console.log('üìä Fetching total messages...');
        const totalMessages = await dbGet('SELECT COUNT(*) as count FROM messages');
        console.log('üìä Total messages:', totalMessages.count);

        const stats = {
            total_users: totalUsers.count,
            total_premium: totalPremium.count,
            total_banned: totalBanned.count,
            total_chats: totalChats.count,
            total_messages: totalMessages.count
        };

        console.log('üìä Final stats object:', stats);

        res.json({
            success: true,
            stats: stats,
            daily_stats: [] // –≤—Ä–µ–º–µ–Ω–Ω–æ —É–ø—Ä–æ—Å—Ç–∏–º
        });
        
    } catch (error) {
        console.error('üí• ADMIN STATS ERROR:', error);
        res.status(500).json({ error: 'Server error' });
    }
});
// –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ª–∏–º–∏—Ç–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
// –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ª–∏–º–∏—Ç–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π)
app.get('/api/user/limits', async (req, res) => {
    try {
        const sessionId = req.headers['authorization'];
        
        console.log('üîê GET USER LIMITS - Session ID:', sessionId);
        
        if (!sessionId) {
            return res.status(401).json({ error: 'Not authenticated' });
        }

        const session = await dbGet(
            `SELECT u.id, u.name, u.is_premium, u.premium_expires_at, 
                    u.requests_used, u.max_requests, u.max_chats, u.is_banned,
                    (SELECT COUNT(*) FROM chats c WHERE c.user_id = u.id AND c.is_active = 1) as current_chats
             FROM sessions s 
             JOIN users u ON s.user_id = u.id 
             WHERE s.id = ? AND s.expires_at > ?`,
            [sessionId, new Date()]
        );

        if (!session) {
            console.log('‚ùå Session not found or expired');
            return res.status(401).json({ error: 'Invalid session' });
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ –∑–∞–±–∞–Ω–µ–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ü–†–Ø–ú–û –ò–ó –ë–ê–ó–´
        if (session.is_banned) {
            console.log(`üö´ Banned user trying to get limits: ${session.id}`);
            await dbRun('DELETE FROM sessions WHERE user_id = ?', [session.id]);
            return res.status(403).json({ 
                error: 'Account is banned',
                is_banned: true
            });
        }

        console.log('‚úÖ User limits found for:', session.name);
        
        res.json({
            success: true,
            user: {
                id: session.id,
                name: session.name,
                is_premium: session.is_premium,
                premium_expires_at: session.premium_expires_at,
                requests_used: session.requests_used,
                max_requests: session.max_requests,
                max_chats: session.max_chats,
                current_chats: session.current_chats,
                requests_remaining: session.max_requests - session.requests_used
            }
        });
        
    } catch (error) {
        console.error('üí• GET USER LIMITS ERROR:', error);
        res.status(500).json({ error: 'Server error' });
    }
});
// –ü–æ–∫—É–ø–∫–∞ –ø—Ä–µ–º–∏—É–º–∞ (–∑–∞–≥–ª—É—à–∫–∞)
app.post('/api/premium/purchase', async (req, res) => {
    try {
        const sessionId = req.headers['authorization'];
        const { plan } = req.body;
        
        console.log('üí∞ PURCHASE PREMIUM - Session ID:', sessionId, 'Plan:', plan);
        
        if (!sessionId) {
            return res.status(401).json({ error: 'Not authenticated' });
        }

        const session = await dbGet(
            `SELECT user_id FROM sessions WHERE id = ? AND expires_at > ?`,
            [sessionId, new Date()]
        );

        if (!session) {
            return res.status(401).json({ error: 'Invalid session' });
        }

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ä–æ–∫ –ø—Ä–µ–º–∏—É–º–∞
        const expiresAt = new Date();
        if (plan === 'yearly') {
            expiresAt.setFullYear(expiresAt.getFullYear() + 1);
        } else {
            expiresAt.setMonth(expiresAt.getMonth() + 1);
        }

        // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø—Ä–µ–º–∏—É–º
        await dbRun(
            'UPDATE users SET is_premium = 1, premium_expires_at = ?, max_requests = 999999, max_chats = 999999 WHERE id = ?',
            [expiresAt.toISOString(), session.user_id]
        );

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–ª–∞—Ç–µ–∂–µ
        const paymentId = uuidv4();
        const amount = plan === 'yearly' ? 2990 : 299;
        
        await dbRun(
            'INSERT INTO payments (id, user_id, amount, status) VALUES (?, ?, ?, ?)',
            [paymentId, session.user_id, amount, 'completed']
        );

        console.log(`‚úÖ Premium activated for user ${session.user_id}, plan: ${plan}`);
        
        res.json({ 
            success: true,
            message: 'Premium activated successfully',
            plan: plan,
            expires_at: expiresAt.toISOString()
        });
        
    } catch (error) {
        console.error('üí• PURCHASE PREMIUM ERROR:', error);
        res.status(500).json({ error: 'Server error' });
    }
});

// –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
app.get('/api/user/avatar', async (req, res) => {
    try {
        const sessionId = req.headers['authorization'];
        
        if (!sessionId) {
            return res.status(401).json({ error: 'Not authenticated' });
        }

        const session = await dbGet(
            `SELECT u.id, u.avatar_data 
             FROM sessions s 
             JOIN users u ON s.user_id = u.id 
             WHERE s.id = ? AND s.expires_at > ?`,
            [sessionId, new Date()]
        );

        if (!session) {
            return res.status(401).json({ error: 'Invalid session' });
        }

        if (session.avatar_data) {
            res.json({
                success: true,
                avatar_data: session.avatar_data
            });
        } else {
            res.json({
                success: true,
                avatar_data: null
            });
        }
        
    } catch (error) {
        console.error('üí• GET AVATAR ERROR:', error);
        res.status(500).json({ error: 'Server error' });
    }
});

// –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∫–∏
app.post('/api/user/avatar', async (req, res) => {
    try {
        const sessionId = req.headers['authorization'];
        const { avatar_data } = req.body;

        if (!sessionId) {
            return res.status(401).json({ error: 'Not authenticated' });
        }

        if (!avatar_data) {
            return res.status(400).json({ error: 'Avatar data is required' });
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏
        const session = await dbGet(
            `SELECT user_id FROM sessions WHERE id = ? AND expires_at > ?`,
            [sessionId, new Date()]
        );

        if (!session) {
            return res.status(401).json({ error: 'Invalid session' });
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –∞–≤–∞—Ç–∞—Ä–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        await dbRun(
            'UPDATE users SET avatar_data = ? WHERE id = ?',
            [avatar_data, session.user_id]
        );

        console.log('‚úÖ AVATAR SAVED SUCCESSFULLY for user:', session.user_id);
        
        res.json({ 
            success: true,
            message: 'Avatar saved successfully'
        });
        
    } catch (error) {
        console.error('üí• SAVE AVATAR ERROR:', error);
        res.status(500).json({ error: 'Server error' });
    }
});

// –≠–Ω–¥–ø–æ–∏–Ω—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
// –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π)
app.get('/api/auth/status', async (req, res) => {
    const sessionId = req.headers['authorization'];
    
    console.log('üîê AUTH STATUS CHECK:', sessionId);
    
    if (sessionId) {
        try {
            const session = await dbGet(
                `SELECT s.user_id, u.name, u.phone, u.email, u.avatar_data, 
                        u.is_premium, u.premium_expires_at, u.is_admin, u.is_banned,
                        u.requests_used, u.max_requests, u.max_chats
                 FROM sessions s 
                 JOIN users u ON s.user_id = u.id 
                 WHERE s.id = ? AND s.expires_at > ?`,
                [sessionId, new Date()]
            );
            
            if (session) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ –∑–∞–±–∞–Ω–µ–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ü–†–Ø–ú–û –ò–ó –ë–ê–ó–´
                if (session.is_banned && !session.is_admin) {
                    console.log(`üö´ Banned user checking status: ${session.user_id}`);
                    // –£–¥–∞–ª—è–µ–º –í–°–ï —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    await dbRun('DELETE FROM sessions WHERE user_id = ?', [session.user_id]);
                    return res.status(403).json({ 
                        success: false, 
                        user: null,
                        message: 'Account is banned',
                        is_banned: true
                    });
                }
                
                console.log('‚úÖ USER AUTHENTICATED:', session.user_id);
                return res.json({
                    success: true,
                    user: {
                        id: session.user_id,
                        name: session.name,
                        phone: session.phone,
                        email: session.email,
                        avatar_data: session.avatar_data,
                        is_premium: session.is_premium,
                        premium_expires_at: session.premium_expires_at,
                        requests_used: session.requests_used,
                        max_requests: session.max_requests,
                        max_chats: session.max_chats,
                        is_admin: session.is_admin === 1
                    }
                });
            } else {
                console.log('‚ùå SESSION NOT FOUND OR EXPIRED');
            }
        } catch (error) {
            console.error('Auth status error:', error);
        }
    }
    
    res.json({ 
        success: false, 
        user: null,
        message: 'Not authenticated'
    });
});

app.post('/api/register', async (req, res) => {
    try {
        const { phone, name, email, birth_date } = req.body;
        
        if (!phone || !name) {
            return res.status(400).json({ error: 'Phone and name are required' });
        }

        const cleanPhone = phone.replace(/\D/g, '');
        const existingUser = await dbGet('SELECT id FROM users WHERE phone = ?', [cleanPhone]);
        
        if (existingUser) {
            return res.status(400).json({ error: 'User with this phone already exists' });
        }

        const userId = uuidv4();
        await dbRun(
            'INSERT INTO users (id, phone, name, email, birth_date) VALUES (?, ?, ?, ?, ?)',
            [userId, cleanPhone, name, email || null, birth_date || null]
        );

        const sessionId = uuidv4();
        const expiresAt = new Date(Date.now() + 30 * 24 * 60 * 60 * 1000);
        
        await dbRun(
            'INSERT INTO sessions (id, user_id, expires_at) VALUES (?, ?, ?)',
            [sessionId, userId, expiresAt]
        );
        
        res.json({ 
            success: true,
            userId: userId,
            sessionId: sessionId,
            message: 'Registration successful'
        });
        
    } catch (error) {
        console.error('üí• REGISTER ERROR:', error);
        res.status(500).json({ error: 'Database error' });
    }
});

// –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –≤—Ö–æ–¥–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π)
app.post('/api/login', async (req, res) => {
    try {
        const { phone } = req.body;
        
        if (!phone) {
            return res.status(400).json({ error: 'Phone is required' });
        }

        const cleanPhone = phone.replace(/\D/g, '');
        const user = await dbGet(
            `SELECT id, name, phone, email, birth_date, avatar_data, 
                    is_premium, premium_expires_at, requests_used, max_requests, 
                    max_chats, created_at, is_admin, is_banned 
             FROM users WHERE phone = ?`, 
            [cleanPhone]
        );
        
        if (!user) {
            return res.status(404).json({ error: 'User not found' });
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–±–∞–Ω–µ–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ü–†–Ø–ú–û –ò–ó –ë–ê–ó–´
        if (user.is_banned) {
            console.log(`üö´ Blocked login attempt for banned user: ${user.id}`);
            // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–µ—Å—Å–∏–∏
            await dbRun('DELETE FROM sessions WHERE user_id = ?', [user.id]);
            return res.status(403).json({ 
                error: 'Account is banned',
                is_banned: true
            });
        }

        const sessionId = uuidv4();
        const expiresAt = new Date(Date.now() + 30 * 24 * 60 * 60 * 1000);
        
        await dbRun(
            'INSERT INTO sessions (id, user_id, expires_at) VALUES (?, ?, ?)',
            [sessionId, user.id, expiresAt]
        );

        res.json({ 
            success: true,
            user: {
                id: user.id,
                name: user.name,
                phone: user.phone,
                email: user.email,
                birth_date: user.birth_date,
                avatar_data: user.avatar_data,
                is_premium: user.is_premium,
                premium_expires_at: user.premium_expires_at,
                requests_used: user.requests_used,
                max_requests: user.max_requests,
                max_chats: user.max_chats,
                is_admin: user.is_admin === 1
            },
            sessionId: sessionId
        });
        
    } catch (error) {
        console.error('üí• LOGIN ERROR:', error);
        res.status(500).json({ error: 'Database error' });
    }
});

// –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
app.post('/api/user/profile', async (req, res) => {
    try {
        const sessionId = req.headers['authorization'];
        const { name, email, birth_date } = req.body;

        if (!sessionId) {
            return res.status(401).json({ error: 'Not authenticated' });
        }

        if (!name) {
            return res.status(400).json({ error: 'Name is required' });
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏
        const session = await dbGet(
            `SELECT user_id FROM sessions WHERE id = ? AND expires_at > ?`,
            [sessionId, new Date()]
        );

        if (!session) {
            return res.status(401).json({ error: 'Invalid session' });
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        await dbRun(
            'UPDATE users SET name = ?, email = ?, birth_date = ? WHERE id = ?',
            [name, email || null, birth_date || null, session.user_id]
        );

        console.log('‚úÖ PROFILE UPDATED SUCCESSFULLY for user:', session.user_id);
        
        res.json({ 
            success: true,
            message: 'Profile updated successfully'
        });
        
    } catch (error) {
        console.error('üí• UPDATE PROFILE ERROR:', error);
        res.status(500).json({ error: 'Server error' });
    }
});

app.post('/api/chats/create', checkUserBan, async (req, res) => {
    try {
        const { userId, firstMessage } = req.body;
        
        if (!userId) {
            return res.status(400).json({ error: 'User ID is required' });
        }

        const user = await dbGet('SELECT id, is_premium, premium_expires_at, max_chats FROM users WHERE id = ?', [userId]);
        if (!user) {
            return res.status(404).json({ error: 'User not found' });
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç—ã —á–∞—Ç–æ–≤
        const chatCount = await dbGet('SELECT COUNT(*) as count FROM chats WHERE user_id = ? AND is_active = 1', [userId]);
        
        const isPremiumActive = user.is_premium && new Date(user.premium_expires_at) > new Date();
        
        if (!isPremiumActive && chatCount.count >= user.max_chats) {
            return res.status(400).json({ 
                error: 'Limit reached',
                message: `–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç —á–∞—Ç–æ–≤. –ú–∞–∫—Å–∏–º—É–º ${user.max_chats} —á–∞—Ç.`,
                limit_type: 'chats'
            });
        }

        const chatId = uuidv4();
        const title = generateChatTitle(firstMessage);
        
        await dbRun(
            'INSERT INTO chats (id, user_id, title) VALUES (?, ?, ?)',
            [chatId, userId, title]
        );

        res.json({ 
            success: true,
            chatId: chatId,
            title: title
        });
        
    } catch (error) {
        console.error('üí• CREATE CHAT ERROR:', error);
        res.status(500).json({ error: 'Database error' });
    }
});
app.post('/api/chats/:chatId/message', checkUserBan, async (req, res) => {
    try {
        const { chatId } = req.params;
        const { message } = req.body;
        
        if (!message) {
            return res.status(400).json({ error: 'Message is required' });
        }

        const chat = await dbGet('SELECT id, user_id, title FROM chats WHERE id = ?', [chatId]);
        if (!chat) {
            return res.status(404).json({ error: 'Chat not found' });
        }

        // –û–ë–ù–û–í–õ–Ø–ï–ú –ù–ê–ó–í–ê–ù–ò–ï –ß–ê–¢–ê –ï–°–õ–ò –û–ù–û –°–¢–ê–ù–î–ê–†–¢–ù–û–ï
        if (chat.title === 'üí≠ –ù–æ–≤—ã–π —Å–æ–Ω' || chat.title === '–ù–æ–≤—ã–π —Å–æ–Ω') {
            const newTitle = generateChatTitle(message);
            await dbRun(
                'UPDATE chats SET title = ? WHERE id = ?',
                [newTitle, chatId]
            );
            console.log('üîÑ Chat title updated:', newTitle);
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤
            const user = await dbGet('SELECT id, is_premium, premium_expires_at, requests_used, max_requests FROM users WHERE id = ?', [chat.user_id]);
        
        const isPremiumActive = user.is_premium && new Date(user.premium_expires_at) > new Date();
        
        if (!isPremiumActive && user.requests_used >= user.max_requests) {
            return res.status(400).json({ 
                error: 'Limit reached',
                message: `–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤. –ú–∞–∫—Å–∏–º—É–º ${user.max_requests} –∑–∞–ø—Ä–æ—Å–æ–≤.`,
                limit_type: 'requests'
            });
        }

        // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ –µ—Å–ª–∏ –Ω–µ –ø—Ä–µ–º–∏—É–º
        if (!isPremiumActive) {
            await dbRun(
                'UPDATE users SET requests_used = requests_used + 1 WHERE id = ?',
                [chat.user_id]
            );
        }

        const messageHistory = await dbAll(
            'SELECT user_message, ai_response FROM messages WHERE chat_id = ? ORDER BY timestamp ASC',
            [chatId]
        );

        const userData = await dbGet('SELECT name FROM users WHERE id = ?', [chat.user_id]);

        let aiResponse;
        
        try {
            aiResponse = await queryGigaChat(message, userData?.name, messageHistory);
        } catch (error) {
            console.error('‚ùå GIGACHAT ERROR:', error);
            aiResponse = `üß† **–ê–Ω–∞–ª–∏–∑ —Å–Ω–∞**\n\n${userData?.name ? `${userData.name}, ` : ''}–≤–∞—à —Å–æ–Ω "${message.substring(0, 50)}..." –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è.\n\n**–í–æ–ø—Ä–æ—Å:** –ö–∞–∫–∏–µ —ç–º–æ—Ü–∏–∏ –≤—ã –∏—Å–ø—ã—Ç—ã–≤–∞–ª–∏ –≤–æ –≤—Ä–µ–º—è —ç—Ç–æ–≥–æ —Å–Ω–∞?`;
        }

        const messageId = uuidv4();
        await dbRun(
            'INSERT INTO messages (id, chat_id, user_message, ai_response) VALUES (?, ?, ?, ?)',
            [messageId, chatId, message, aiResponse]
        );

        await dbRun(
            'UPDATE chats SET last_message_at = CURRENT_TIMESTAMP WHERE id = ?',
            [chatId]
        );

        res.json({ 
            success: true,
            response: aiResponse
        });
        
    } catch (error) {
        console.error('üí• SEND MESSAGE ERROR:', error);
        res.status(500).json({ error: 'Server error' });
    }
});
// –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –≥–æ—Å—Ç–µ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
// –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –≥–æ—Å—Ç–µ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
app.post('/api/guest/message', async (req, res) => {
    try {
        const { message, chatId, messageHistory } = req.body;
        
        if (!message) {
            return res.status(400).json({ error: 'Message is required' });
        }

        let aiResponse;
        
        try {
            // –ü–ï–†–ï–î–ê–ï–ú –ò–°–¢–û–†–ò–Æ –°–û–û–ë–©–ï–ù–ò–ô –í GIGACHAT
            const history = messageHistory || [];
            aiResponse = await queryGigaChat(message, '–ì–æ—Å—Ç—å', history);
        } catch (error) {
            console.error('‚ùå GUEST GIGACHAT ERROR:', error);
            // Fallback –æ—Ç–≤–µ—Ç –µ—Å–ª–∏ GigaChat –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
            aiResponse = `üß† **–ê–Ω–∞–ª–∏–∑ —Å–Ω–∞**\n\n–í–∞—à —Å–æ–Ω "${message.substring(0, 50)}..." –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è.\n\n**–í–æ–ø—Ä–æ—Å:** –ö–∞–∫–∏–µ —ç–º–æ—Ü–∏–∏ –≤—ã –∏—Å–ø—ã—Ç—ã–≤–∞–ª–∏ –≤–æ –≤—Ä–µ–º—è —ç—Ç–æ–≥–æ —Å–Ω–∞?`;
        }

        res.json({ 
            success: true,
            response: aiResponse
        });
        
    } catch (error) {
        console.error('üí• GUEST MESSAGE ERROR:', error);
        res.status(500).json({ error: 'Server error' });
    }
});
// –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
app.get('/api/admin/check', async (req, res) => {
    try {
        const sessionId = req.headers['authorization'];
        
        if (!sessionId) {
            return res.json({ success: false, is_admin: false });
        }

        const session = await dbGet(
            `SELECT u.id, u.is_admin FROM sessions s 
             JOIN users u ON s.user_id = u.id 
             WHERE s.id = ? AND s.expires_at > ?`,
            [sessionId, new Date()]
        );

        if (!session) {
            return res.json({ success: false, is_admin: false });
        }

        res.json({
            success: true,
            is_admin: session.is_admin === 1
        });
        
    } catch (error) {
        console.error('üí• ADMIN CHECK ERROR:', error);
        res.json({ success: false, is_admin: false });
    }
});

// –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
app.get('/api/admin/stats', async (req, res) => {
    try {
        const sessionId = req.headers['authorization'];
        
        if (!sessionId) {
            return res.status(401).json({ error: 'Not authenticated' });
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω–æ–º
        const session = await dbGet(
            `SELECT u.id, u.is_admin FROM sessions s 
             JOIN users u ON s.user_id = u.id 
             WHERE s.id = ? AND s.expires_at > ?`,
            [sessionId, new Date()]
        );

        if (!session || !session.is_admin) {
            return res.status(403).json({ error: 'Access denied' });
        }

        // –ü–æ–ª—É—á–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        const totalUsers = await dbGet('SELECT COUNT(*) as count FROM users');
        const totalPremium = await dbGet('SELECT COUNT(*) as count FROM users WHERE is_premium = 1');
        const totalBanned = await dbGet('SELECT COUNT(*) as count FROM users WHERE is_banned = 1');
        const totalChats = await dbGet('SELECT COUNT(*) as count FROM chats');
        const totalMessages = await dbGet('SELECT COUNT(*) as count FROM messages');
        
        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–Ω—è–º (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π)
        const dailyStats = await dbAll(`
            SELECT 
                DATE(created_at) as date,
                COUNT(*) as user_count
            FROM users 
            WHERE created_at >= date('now', '-7 days')
            GROUP BY DATE(created_at)
            ORDER BY date DESC
        `);

        // –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        const recentUsers = await dbAll(`
            SELECT id, phone, name, email, is_premium, is_banned, created_at, 
                   (SELECT COUNT(*) FROM chats c WHERE c.user_id = users.id) as chat_count,
                   (SELECT COUNT(*) FROM messages m WHERE m.chat_id IN (SELECT id FROM chats WHERE user_id = users.id)) as message_count
            FROM users 
            ORDER BY created_at DESC 
            LIMIT 50
        `);

        res.json({
            success: true,
            stats: {
                total_users: totalUsers.count,
                total_premium: totalPremium.count,
                total_banned: totalBanned.count,
                total_chats: totalChats.count,
                total_messages: totalMessages.count
            },
            daily_stats: dailyStats,
            users: recentUsers
        });
        
    } catch (error) {
        console.error('üí• ADMIN STATS ERROR:', error);
        res.status(500).json({ error: 'Server error' });
    }
});
app.get('/api/chats/:userId', async (req, res) => {
    try {
        const { userId } = req.params;
        
        const chats = await dbAll(
            `SELECT c.id, c.title, c.created_at, c.last_message_at,
                    (SELECT COUNT(*) FROM messages m WHERE m.chat_id = c.id) as message_count
             FROM chats c 
             WHERE c.user_id = ? AND c.is_active = 1
             ORDER BY c.last_message_at DESC`,
            [userId]
        );

        res.json({ 
            success: true,
            chats: chats
        });
        
    } catch (error) {
        console.error('üí• GET CHATS ERROR:', error);
        res.status(500).json({ error: 'Database error' });
    }
});

app.get('/api/chats/:chatId/messages', async (req, res) => {
    try {
        const { chatId } = req.params;
        
        const messages = await dbAll(
            'SELECT user_message, ai_response, timestamp FROM messages WHERE chat_id = ? ORDER BY timestamp ASC',
            [chatId]
        );

        const chatInfo = await dbGet('SELECT title, user_id FROM chats WHERE id = ?', [chatId]);

        res.json({ 
            success: true,
            messages: messages,
            chatInfo: chatInfo
        });
        
    } catch (error) {
        console.error('üí• GET MESSAGES ERROR:', error);
        res.status(500).json({ error: 'Database error' });
    }
});

app.delete('/api/chats/:chatId', async (req, res) => {
    try {
        const { chatId } = req.params;
        const { userId } = req.query;
        
        if (!userId) {
            return res.status(400).json({ error: 'User ID is required' });
        }

        const chat = await dbGet('SELECT id FROM chats WHERE id = ? AND user_id = ?', [chatId, userId]);
        
        if (!chat) {
            return res.status(404).json({ error: 'Chat not found or access denied' });
        }

        await dbRun('DELETE FROM messages WHERE chat_id = ?', [chatId]);
        await dbRun('DELETE FROM chats WHERE id = ?', [chatId]);

        res.json({ 
            success: true,
            message: 'Chat deleted successfully'
        });
        
    } catch (error) {
        console.error('üí• DELETE CHAT ERROR:', error);
        res.status(500).json({ error: 'Database error' });
    }
});

app.post('/api/logout', async (req, res) => {
    const sessionId = req.headers['authorization'];
    
    if (sessionId) {
        try {
            await dbRun('DELETE FROM sessions WHERE id = ?', [sessionId]);
        } catch (error) {
            console.error('Logout error:', error);
        }
    }
    
    res.json({ success: true });
});

app.use(express.static(path.join(__dirname, '../frontend')));
app.get('*', (req, res) => {
    res.sendFile(path.join(__dirname, '../frontend/index.html'));
});

app.listen(PORT, () => {
    console.log(`\nüéØ DREAM INTERPRETER SERVER running on http://localhost:${PORT}`);

});
